


<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="TolaData - TolaActivity: Putting Adaptive Management into Practice">
        <meta name="author" content="TolaData">

        <title>Indicator Performance Tracking TableTolaActivity</title>

        <link rel="icon" href="/static/img/favicon.ico">

        <!-- Datatables css for HTML tables -->
        <link href="/static/css/datatables.min.css" rel="stylesheet" type="text/css">

        <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css">

        <!-- select2 -->
        <link rel="stylesheet" href="/static/css/select2.min.css ">


        <!-- Custom CSS -->
        <link href="/static/css/app_bootstrap_overrides.css?v=ww" rel="stylesheet" type="text/css">

        <!--- Django Tables2 css -->
        <link rel="stylesheet" href="/static/django_tables2/themes/paleblue/css/screen.css">

        <!-- Hosted Leaflet CSS -->
        <link rel="stylesheet" href="/static/css/leaflet.css">

        <link rel="stylesheet" href="/static/css/jquery-ui.min.css?v=ww">

        <script src="/static/js/jquery.min.js"></script>

        <!-- Hosted Leaflet -->
        <script src="/static/js/leaflet.js"></script>



    </head>
    <body class="page_iptt_table">

        <nav class="navbar navbar-expand-sm navbar-dark bg-dark navbar-tola">
            <div class="container-fluid navbar-tola--container">
                <button
                    class="navbar-toggler m-1"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="d-flex flex-column" style="flex-grow:1;">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <div class="navbar-brand-wrapper">
                            <div class="navbar-brand--mc">
                                <img class="navbar-brand--mc-logo" src="/static/img/mc_logo_bounded.svg" />
                            </div>
                            <a class="navbar-brand--tola" href="/">
                                <img class="navbar-brand--tola-logo" src="/static/img/tola_activity_white.svg" />
                            </a>
                        </div>

                        <ul class="navbar-nav">
                            <li class="nav-item pr-2 mr-3">
                                <a class="nav-link" href="#">Indicators</a>
                            </li>
                            <li class="nav-item dropdown pr-2 mr-3">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarBrowse" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Browse</a>
                                <div class="dropdown-menu" aria-labelledby="navbarBrowse">
                                    <a class="dropdown-item" href="/workflow/documentation_list/">Documents</a>
                                    <a class="dropdown-item" href="/workflow/dashboard/0/">Projects</a>
                                    <a class="dropdown-item" href="/workflow/siteprofile_list/0/0/">Sites</a>
                                    <a class="dropdown-item" href="/workflow/stakeholder_list/0/0">Stakeholders</a>
                                </div>
                            </li>
                            <li class="nav-item dropdown pr-2 mr-3">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarReportsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Reports</a>
                                <div class="dropdown-menu" aria-labelledby="navbarReportsDropdown">
                                    <a class="dropdown-item" href="/indicators/iptt_quickstart/">Indicator Performance Tracking Table</a>
                                    <a class="dropdown-item" href="/indicators/disrep/0/">Indicator Disaggregation Report</a>
                                    <a class="dropdown-item" href="/workflow/report/0/none">Project Report</a>

                                </div>
                            </li>
                        </ul>

                        <ul class="navbar-nav ml-auto">

                                <li class="nav-item">
                                  <a class="nav-link" href="/accounts/profile/">

                                            <span class="badge badge-danger">LOCAL SERVER</span>

                                        Cameron McFee
                                    </a>
                                </li>

                        </ul>
                    </div>

                </div>

            </div>
        </nav>

        <div id="nonfooter" class="report-wide">

            <div id="id_div_breadcrumb"></div>
            <h1 class="page-title"></h1>
            <div id="alerts">
                <!-- Any messages for users -->



            </div>

            <!-- Main body content -->
            <div id="id_div_content">

  <div class="sidebar_wrapper">
      <div class="collapse width show" id="sidebar">



<script>
  // emulate the appearance of multiselects BEFORE jquery loads to prevent an HTML flash
  // Iâ€™m doing this by way of a scrpt for the sake of users w/JS disabled
  document.write('<style type="text/css">.bs-multiselect { background: white; border: 1px solid #808080; color: #808080; height: 38px; }</style>');
</script>

<style type="text/css">
  .ui-datepicker-calendar {
    display: none;
  }
</style>
<nav id="id_iptt_report_filter">
  <form id="id_form_indicator_filter" method="POST" novalidate>
    <input type='hidden' name='csrfmiddlewaretoken' value='VoV8hrYE7VwjfgZExn6YrkNuVqcGDe0SNz2vnIrbKDtlxuIx2K95gDHqagM8Z1Lf' />

    <div id="filter-top" class="p-3">
      <h3 class="filter-title">Report Options</h3>
      <div class="form-row mb-3" id="id_div_program">
        <label for="id_program" class="col-form-label">
          Program
        </label>
        <select name="program" required class="form-control" id="id_program">
  <option value="">---------</option>

  <option value="541">Global Network Rollout (HQ IT)</option>

  <option value="542" selected>TolaData Demo</option>

  <option value="452">TolaData Rollout Project</option>

  <option value="442">TolaData Test</option>

  <option value="550">VISTA</option>

</select>
      </div>

      <div class="form-row mb-3" id="id_div_targetperiods">
        <label for="id_targetperiods" class="col-form-label">

            TARGET PERIODS
            </label>
            <select name="targetperiods" class="form-control" id="id_targetperiods">
  <option value="2">Midline and endline</option>

  <option value="3">Annual</option>

  <option value="6" selected>Quarterly</option>

</select>

      </div>

      <div class="form-row mb-3">


            <div class="col-sm-4 ">
              <div class="form-check form-check-inline pt-1" id="div_id_timeframe_0">
                <span class="form-check-input ">
                    <input type="radio" name="timeframe" value="1" checked id="id_timeframe_0" />
                </span>
                <label class="form-check-label" for="id_timeframe_0">
                  Show all
                </label>
              </div>
            </div>



            <div class=" col-sm-4 p-0 ">
              <div class="form-check form-check-inline pt-1" id="div_id_timeframe_1">
                <span class="form-check-input ">
                    <input type="radio" name="timeframe" value="2" id="id_timeframe_1" />
                </span>
                <label class="form-check-label" for="id_timeframe_1">
                  Most recent
                </label>
              </div>
            </div>


        <div class="col-sm-4">
          <input type="number" name="numrecentperiods" placeholder="" class="form-control" id="id_numrecentperiods" />
        </div>
      </div>

      <div class="form-row mb-3" id="id_div_program">
        <label for="id_start_period" class="col-form-label">
          START
        </label>
        <select name="start_period" class="form-control" id="id_start_period">
  <optgroup label="2016">
  <option value="2016-01-01" selected>Quarter 1 (Jan 01, 2016 - Mar 31, 2016)</option>

  <option value="2016-04-01">Quarter 2 (Apr 01, 2016 - Jun 30, 2016)</option>

  <option value="2016-07-01">Quarter 3 (Jul 01, 2016 - Sep 30, 2016)</option>

  <option value="2016-10-01">Quarter 4 (Oct 01, 2016 - Dec 31, 2016)</option>

  </optgroup>
  <optgroup label="2017">
  <option value="2017-01-01">Quarter 5 (Jan 01, 2017 - Mar 31, 2017)</option>

  <option value="2017-04-01">Quarter 6 (Apr 01, 2017 - Jun 30, 2017)</option>

  <option value="2017-07-01">Quarter 7 (Jul 01, 2017 - Sep 30, 2017)</option>

  <option value="2017-10-01">Quarter 8 (Oct 01, 2017 - Dec 31, 2017)</option>

  </optgroup>
  <optgroup label="2018">
  <option value="2018-01-01">Quarter 9 (Jan 01, 2018 - Mar 31, 2018)</option>

  <option value="2018-04-01">Quarter 10 (Apr 01, 2018 - Jun 30, 2018)</option>

  <option value="2018-07-01">Quarter 11 (Jul 01, 2018 - Sep 30, 2018)</option>

  <option value="2018-10-01">Quarter 12 (Oct 01, 2018 - Dec 31, 2018)</option>

  </optgroup>
  <optgroup label="2019">
  <option value="2019-01-01">Quarter 13 (Jan 01, 2019 - Mar 31, 2019)</option>

  <option value="2019-04-01">Quarter 14 (Apr 01, 2019 - Jun 30, 2019)</option>

  <option value="2019-07-01">Quarter 15 (Jul 01, 2019 - Sep 30, 2019)</option>

  <option value="2019-10-01">Quarter 16 (Oct 01, 2019 - Dec 31, 2019)</option>

  </optgroup>
  <optgroup label="2020">
  <option value="2020-01-01">Quarter 17 (Jan 01, 2020 - Mar 31, 2020)</option>

  <option value="2020-04-01">Quarter 18 (Apr 01, 2020 - Jun 30, 2020)</option>

  <option value="2020-07-01">Quarter 19 (Jul 01, 2020 - Sep 30, 2020)</option>

  <option value="2020-10-01">Quarter 20 (Oct 01, 2020 - Dec 31, 2020)</option>

  </optgroup>
</select>
      </div>

      <div class="form-row mb-3" id="id_div_program">
        <label for="id_end_period" class="col-form-label">
          END
        </label>
        <select name="end_period" class="form-control" id="id_end_period">
  <optgroup label="2016">
  <option value="2016-03-31">Quarter 1 (Jan 01, 2016 - Mar 31, 2016)</option>

  <option value="2016-06-30">Quarter 2 (Apr 01, 2016 - Jun 30, 2016)</option>

  <option value="2016-09-30">Quarter 3 (Jul 01, 2016 - Sep 30, 2016)</option>

  <option value="2016-12-31">Quarter 4 (Oct 01, 2016 - Dec 31, 2016)</option>

  </optgroup>
  <optgroup label="2017">
  <option value="2017-03-31">Quarter 5 (Jan 01, 2017 - Mar 31, 2017)</option>

  <option value="2017-06-30">Quarter 6 (Apr 01, 2017 - Jun 30, 2017)</option>

  <option value="2017-09-30">Quarter 7 (Jul 01, 2017 - Sep 30, 2017)</option>

  <option value="2017-12-31">Quarter 8 (Oct 01, 2017 - Dec 31, 2017)</option>

  </optgroup>
  <optgroup label="2018">
  <option value="2018-03-31">Quarter 9 (Jan 01, 2018 - Mar 31, 2018)</option>

  <option value="2018-06-30">Quarter 10 (Apr 01, 2018 - Jun 30, 2018)</option>

  <option value="2018-09-30">Quarter 11 (Jul 01, 2018 - Sep 30, 2018)</option>

  <option value="2018-12-31">Quarter 12 (Oct 01, 2018 - Dec 31, 2018)</option>

  </optgroup>
  <optgroup label="2019">
  <option value="2019-03-31">Quarter 13 (Jan 01, 2019 - Mar 31, 2019)</option>

  <option value="2019-06-30">Quarter 14 (Apr 01, 2019 - Jun 30, 2019)</option>

  <option value="2019-09-30">Quarter 15 (Jul 01, 2019 - Sep 30, 2019)</option>

  <option value="2019-12-31">Quarter 16 (Oct 01, 2019 - Dec 31, 2019)</option>

  </optgroup>
  <optgroup label="2020">
  <option value="2020-03-31">Quarter 17 (Jan 01, 2020 - Mar 31, 2020)</option>

  <option value="2020-06-30">Quarter 18 (Apr 01, 2020 - Jun 30, 2020)</option>

  <option value="2020-09-30">Quarter 19 (Jul 01, 2020 - Sep 30, 2020)</option>

  <option value="2020-12-31" selected>Quarter 20 (Oct 01, 2020 - Dec 31, 2020)</option>

  </optgroup>
</select>
      </div>
    </div>

    <div id="filter-middle" class="p-3">
      <div class="form-group mb-2" id="id_div_level">
        <label for="id_level" class="col-form-label text-uppercase">
          Levels
        </label>
        <div class="form-group-row">
          <select name="level" multiple="multiple" class="form-control bs-multiselect" id="id_level">
  <option value="3">Outcome</option>

  <option value="2">Output</option>

</select>
        </div>
      </div>

      <div class="form-group mb-2" id="id_div_type">
        <label for="id_type" class="col-form-label text-uppercase">
          Types
        </label>
        <div class="form-group-row">
          <select name="ind_type" multiple="multiple" class="form-control bs-multiselect" id="id_ind_type">
  <option value="1">Custom</option>

  <option value="9">Alpha</option>

  <option value="8">Standard</option>

  <option value="7">Donor</option>

</select>
        </div>
      </div>

      <div class="form-group mb-2" id="id_div_sector">
        <label for="id_sector" class="col-form-label text-uppercase">
          Sectors
        </label>
        <div class="form-group-row">
          <select name="sector" multiple="multiple" class="form-control bs-multiselect" id="id_sector">
  <option value="3">Conflict Management</option>

  <option value="32">Emergency</option>

  <option value="28">Gender</option>

  <option value="14">WASH</option>

</select>
        </div>
      </div>

      <div class="form-group mb-2" id="id_div_site">
        <label for="id_site" class="col-form-label text-uppercase">
          Sites
        </label>
        <div class="form-group-row">
          <select name="site" multiple="multiple" class="form-control bs-multiselect" id="id_site">
  <option value="4526">Afghanistan</option>

  <option value="4540">China</option>

  <option value="4604">Colombia</option>

  <option value="4550">Democratic Republic of Congo</option>

  <option value="4528">Ethiopia</option>

  <option value="4551">Georgia</option>

  <option value="4869">Greece</option>

  <option value="4547">Haiti</option>

  <option value="4928">Houston, TX, USA</option>

  <option value="4542">India</option>

  <option value="4539">Indonesia</option>

  <option value="4536">Iraq</option>

  <option value="4533">Jordan</option>

  <option value="4530">Kenya</option>

  <option value="4927">New Orleans, LA, USA</option>

  <option value="4929">New York City, NY, USA</option>

</select>
        </div>
      </div>

      <div class="form-group mb-2" id="id_div_indicators">
        <label for="id_indicators" class="col-form-label text-uppercase">
          Indicators
        </label>
        <div class="form-group-row">
          <select name="indicators" multiple="multiple" class="form-control bs-multiselect" id="id_indicators">
  <option value="5145">Number of reported incidents of violence</option>

  <option value="5147">Number of NFI kits distributed</option>

  <option value="5148">Number of households with access to safe water</option>

  <option value="5149">Percent of households with access to an improved sanitation facility</option>

  <option value="5178">Number of local women participating in a substantive role or position in a peace-building process.</option>

  <option value="5179">Percent of community members who believe that those responsible for conflict management in their area are able to prevent and/or resolve conflicts in their community.</option>

  <option value="5180">Percent of population that has the necessary knowledge about key public health risks and has the capacity to adopt safe hygiene practices</option>

  <option value="5181">Number of individuals receiving emergency relief services showing change in assessed conditions.</option>

  <option value="5182">Number of safe spaces established for women and youth</option>

  <option value="5647">Number of people who know at least three of five critical times to wash hands</option>

  <option value="5648">Percentage of eligible Out-Of-School Girls (OSGs) supported by the project to re-enter formal education.</option>

</select>
        </div>
      </div>

    </div>

    <div id="filter-bottom" class=" d-flex justify-content-between no-gutters p-3">
      <div class="col pr-2">
        <button type="submit" id="id_submit_form_filter" class="btn btn-block btn-primary">
          Apply
        </button>
      </div>
      <div class="col pl-2">
        <button type="reset" class="btn btn-block btn-secondary">
          Reset
        </button>
      </div>
    </div>
  </form>
</nav>

<script>
  $(document).ready(function () {
    const site_profile = $("#id_site");
    const indicators_select = $("#id_indicators");
    const numRecentPeriods = $("#id_numrecentperiods");
    const checkShowAllPeriods = $("#id_timeframe_0");
    const checkFilterPeriods = $("#id_timeframe_1");
    const sector_select = $("#id_sector");
    const indicatortype_select = $("#id_ind_type");
    const level_select = $("#id_level");

    const program_select = $("#id_program");
    const timeperiod_select = $("#id_timeperiods");
    const targetperiod_select = $("#id_targetperiods");

    const start_period_id = `id_start_period`;
    const start_period = $(`#${start_period_id}`);
    const end_period_id = `id_end_period`;
    const end_period = $(`#${end_period_id}`);

    var multiselectOptions = {
      includeSelectAllOption: true,
      enableFiltering: true,
      enableCaseInsensitiveFiltering: true,
      numberDisplayed: 1,
      maxHeight: 320,
      buttonClass: 'btn btn-light form-control',
      templates: {
        filter: '<li class="multiselect-item filter"><div class="input-group"><input class="form-control multiselect-search" type="text"></div></li>',
        filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="fas fa-times-circle"></i></button></span>',
      }
    }

    level_select.multiselect(multiselectOptions);
    indicatortype_select.multiselect(multiselectOptions);
    sector_select.multiselect(multiselectOptions);
    site_profile.multiselect(multiselectOptions);
    indicators_select.multiselect(multiselectOptions);

    function disableFormElements() {
      numRecentPeriods.prop('readonly', true);
      checkFilterPeriods.prop('disabled', true);
      // checkShowAllPeriods.prop('disabled', true);
      numRecentPeriods.val('');
      checkShowAllPeriods.prop('checked', true);
      checkFilterPeriods.prop('checked', false);
      start_period.prop('readonly', true);
      end_period.prop('readonly', true);
    }

    // if targetperiods value is LOP then disable certain elements on the filter form
    if (targetperiod_select.val() == 1 || targetperiod_select.val() == 2 ) {
      disableFormElements();
    } else {
      checkFilterPeriods.prop('disabled', false);
      checkShowAllPeriods.prop('disabled', false);
      numRecentPeriods.prop('readonly', false);
      start_period.prop('readonly', false);
      end_period.prop('readonly', false);
    }

    // get the appropriate url params for the page reload
    function get_reload_url(frequency) {
      const program_id = program_select.val();
      const timeperiod = timeperiod_select.val();
      const targetperiod = targetperiod_select.val();
      const numrecentperiods = numRecentPeriods.val();
      let timeframe = '';
      // let frequency = '';
      let reporttype = '';

      if (timeperiod) {
        frequency = timeperiod;
        reporttype = 'timeperiods';
      } else {
        frequency = targetperiod;
        reporttype = 'targetperiods';
      }

      if (numrecentperiods) {
        timeframe = 2;
      } else {
        timeframe = 1;
      }
      let url = `/indicators/iptt_report/0/targetperiods/`;
      url = url.replace(/0/, program_id);

      url = `${url}?${reporttype}=${frequency}&numrecentperiods=${numrecentperiods}&timeframe=${timeframe}`;
      return url;
    }

    // on timeperiod dropdown change, reload the report with correct filtering options
    $("#id_form_indicator_filter").on("input", "#id_timeperiods", function (e) {
      const url = get_reload_url();
      window.location = url;
    });

    // on targetperiod dropdown change, reload the report with correct filtering options
    $("#id_form_indicator_filter").on("input", "#id_targetperiods", function (e) {
      if (this.value == 1 || this.value == 2) {
        disableFormElements();
      }
      const url = get_reload_url();
      window.location = url;
    });

    // upon program dropdown change, reload the report with correct filtering options
    $("#id_form_indicator_filter").on("input", "#id_program", function (e) {
      const url = get_reload_url();
      window.location = url;

      /*
      $.getJSON(`/api/siteprofile/?program=${program_id}`, function( data ){
        site_profile.empty();
        $.each(data, function(index, option){
          site_profile.append($("<option></option>").attr("value", option.id).text(option.name));
        });
        site_profile.multiselect('rebuild');
      });

      $.getJSON(`/api/indicator/?program=${program_id}`, function(data) {
       indicators_select.empty();
       $.each(data, function (index, option) {
         indicators_select.append($("<option></option>").attr("value", option.id).text(option.name));
       });
       indicators_select.multiselect('rebuild');
      });

      $.getJSON(`/api/sector/?program=${program_id}`, function( data ) {
       sector_select.empty();
       $.each(data, function(index, option){
         sector_select.append($("<option></option>").attr("value", option.id).text(option.sector));
       });
        sector_select.multiselect('rebuild');
      });

      $.getJSON(`/api/indicatortype/?program=${program_id}`, function( data ){
       indicatortype_select.empty();
       $.each(data, function(index, option){
         indicatortype_select.append($("<option></option>").attr("value", option.id).text(option.indicator_type));
       });
       indicatortype_select.multiselect('rebuild');
      });

      $.getJSON(`/api/level/?program=${program_id}`, function(data) {
       level_select.empty();
       $.each(data, function(index, option){
         level_select.append($("<option></option>").attr("value", option.id).text(option.name));
       });
       level_select.multiselect('rebuild');
      })
      */

    });

    // changing the start_period triggers updating the end_period if necessary
    // to make sure the start and end periods do not cross each other.
    start_period.on('change', function(e){
      const selectedIndex = $(this).prop('selectedIndex');
      end_period.find(`option:lt(${selectedIndex})`).prop('disabled', true);
      end_period.find(`option:gt(${selectedIndex})`).prop('disabled', false);
      end_period.find(`option:eq(${selectedIndex})`).prop('disabled', false);
      if (end_period.find('option:selected').prop('disabled') == true) {
        end_period.val($(`#${end_period_id} option:enabled`).eq(0).val());
      }
      $("input[type=radio][name='timeframe']").prop("checked", false);
      numRecentPeriods.val('');
    });

    // changing the end_period triggers updating the start_period if necessary
    // to make sure the start and end periods do not cross each other.
    end_period.on('change', function (e) {
      const selectedIndex = $(this).prop('selectedIndex');
      start_period.find(`option:gt(${selectedIndex})`).prop('disabled', true);
      start_period.find(`option:lt(${selectedIndex})`).prop('disabled', false);
      start_period.find(`option:eq(${selectedIndex})`).prop('disabled', false);
      if (start_period.find('option:selected').prop('disabled') == true) {
        start_period.val($(`#${start_period_id} option:enabled`).eq(0).val());
      }
      $("input[type=radio][name='timeframe']").prop("checked", false);
      numRecentPeriods.val('');
    });

    // Behaviors for "most recent" field
    // Clicking on the text box selects the associated radio button
    numRecentPeriods.on('focus', function(e){
      if (targetperiod_select.val() == 1 | targetperiod_select.val() == 2) {
        return;
      }
      checkFilterPeriods.prop('checked', true);
    });
    // clicking on "show all" zeroes the most_recent field and
    // resets the start and end periods dropdowns
    checkShowAllPeriods.on('change', function(e){
      numRecentPeriods.val('');
      start_period.find('option').prop('disabled', false);
      start_period.val($(`#${start_period_id} option:first`).val());
      end_period.find('option').prop('disabled', false);
      end_period.val($(`#${end_period_id} option:last`).val());
    });
    // clicking on "most recent" focuses the field
    checkFilterPeriods.on('change', function(e){
      numRecentPeriods.focus();
    });

    $('button[type=reset]').on('click', function(e){
      window.location.reload();
    });

  });
</script>

      </div>
      <div class="sidebar-toggle">
        <a href="#" data-target="#sidebar" data-toggle="collapse" title="Show/hide filters">
          <i class="fa fa-chevron-left"></i>
        </a>
      </div>
  </div>
  <main class="iptt_table_wrapper">
    <div id="id_div_top_iptt_report">
        <div class="d-flex justify-content-between">
            <div id="id_span_iptt_date_range">
              <h2 class="pt-3">Indicator Performance Tracking Table</h2>
              <h4 class="pb-3">Jan 1, 2016 - Dec 31, 2020</h4>
            </div>
            <div class="p-3">
              <a href="/indicators/iptt_excel/542/targetperiods/?targetperiods=6&amp;timeframe=1" class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Excel</a>
            </div>
        </div>

        <table id="iptt_table" class="table table-sm table-bordered table-hover">
          <colgroup scope="col" span="9"></colgroup>
          <colgroup scope="col" span="3" class="lopCols"></colgroup>
          <colgroup scope="col" span="20"></colgroup>
          <thead class="thead-light">
          <tr>
            <td colspan="9" id="id_td_iptt_program_name" class="lopCols align-bottom pt-2">
              <h5 class="m-0"><strong>TolaData Demo</strong></h5>
            </td>
            <td scope="colgroup" colspan="3" class="text-center align-bottom text-uppercase">
              Life of program
            </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 1<br>

                    <small>Jan 1, 2016 - Mar 31, 2016</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 2<br>

                    <small>Apr 1, 2016 - Jun 30, 2016</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 3<br>

                    <small>Jul 1, 2016 - Sep 30, 2016</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 4<br>

                    <small>Oct 1, 2016 - Dec 31, 2016</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 5<br>

                    <small>Jan 1, 2017 - Mar 31, 2017</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 6<br>

                    <small>Apr 1, 2017 - Jun 30, 2017</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 7<br>

                    <small>Jul 1, 2017 - Sep 30, 2017</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 8<br>

                    <small>Oct 1, 2017 - Dec 31, 2017</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 9<br>

                    <small>Jan 1, 2018 - Mar 31, 2018</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 10<br>

                    <small>Apr 1, 2018 - Jun 30, 2018</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 11<br>

                    <small>Jul 1, 2018 - Sep 30, 2018</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 12<br>

                    <small>Oct 1, 2018 - Dec 31, 2018</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 13<br>

                    <small>Jan 1, 2019 - Mar 31, 2019</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 14<br>

                    <small>Apr 1, 2019 - Jun 30, 2019</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 15<br>

                    <small>Jul 1, 2019 - Sep 30, 2019</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 16<br>

                    <small>Oct 1, 2019 - Dec 31, 2019</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 17<br>

                    <small>Jan 1, 2020 - Mar 31, 2020</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 18<br>

                    <small>Apr 1, 2020 - Jun 30, 2020</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 19<br>

                    <small>Jul 1, 2020 - Sep 30, 2020</small>

                </td>

                <td scope="col"
                     colspan="3"
                    class="text-center lopCols text-nowrap align-bottom">
                  QUARTER 20<br>

                    <small>Oct 1, 2020 - Dec 31, 2020</small>

                </td>

          </tr>
          <tr>
            <th scope="col" class="align-bottom text-uppercase" style="min-width:80px">No.</th>
            <th scope="col" class="align-bottom text-uppercase td-no-side-borders" style="min-width:600px">Indicator</th>
            <th scope="col" class="align-bottom text-uppercase td-no-side-borders"></th>
            <th scope="col" class="align-bottom text-uppercase" style="min-width:90px">Level</th>
            <th scope="col" class="align-bottom text-uppercase" style="min-width:250px">Unit of measure</th>
            <th scope="col" class="align-bottom text-uppercase">Change</th>
            <th scope="col" class="align-bottom text-uppercase" style="min-width:130px">C / NC</th>
            <th scope="col" class="align-bottom text-uppercase" style="min-width:50px"># / %</th>
            <th scope="col" class="align-bottom text-uppercase" >Baseline</th>
            <th scope="col" class="align-bottom text-uppercase text-right td-no-side-borders" style="min-width: 110px;">Target</th>
            <th scope="col" class="align-bottom text-uppercase text-right td-no-side-borders" style="min-width: 110px;">Actual</th>
            <th scope="col" class="align-bottom text-uppercase text-right td-no-side-borders" style="min-width: 110px;">% Met</th>


                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>

                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Target</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">Actual</th>
                <th scope="col" class="text-uppercase text-right" style="min-width: 110px;">% Met</th>


          </tr>
          </thead>
          <tbody>

            <tr>
              <td class="td-no-side-borders">1.1.1</td>
              <td class="td-no-side-borders">
                <button type="button"
                        class="btn btn-link p-1 indicator-ajax-popup indicator-data"
                        data-indicatorid=5178
                        data-container="body"
                        data-trigger="focus"
                        data-toggle="popover"
                        data-placement="bottom">
                  <i class="fas fa-table"></i>
                </button>
                Number of local women participating in a substantive role or position in a peace-building process.
              </td>
              <td class="td-no-side-borders">
                <a href="/indicators/indicator_update/5178/"
                   data-programid="542"
                   class="indicator-link float-right">
                  <i class="fas fa-cog"></i>
                </a>
              </td>
              <td class="td-no-side-borders">Output</td>
              <td class="td-no-side-borders">Local Women</td>
              <td class="td-no-side-borders" align="right">+</td>
              <td class="td-no-side-borders">
                Cumulative
              </td>
              <td class="td-no-side-borders">#</td>
              <td class="td-no-side-borders" align="right">
                25
              </td>
              <td class="td-no-side-borders" align="right">
                100
              </td>
              <td class="td-no-side-borders" align="right">
                64
              </td>

              <td class="td-no-side-borders" align="right">
                64%
              </td>


                  <td align="right" class="border-right-0">

                      25

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      22

                  </td>
                  <td align="right" class="border-left-0">

                      88%

                  </td>

                  <td align="right" class="border-right-0">

                      25

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      25

                  </td>
                  <td align="right" class="border-left-0">

                      100%

                  </td>

                  <td align="right" class="border-right-0">

                      25

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      32

                  </td>
                  <td align="right" class="border-left-0">

                      128%

                  </td>

                  <td align="right" class="border-right-0">

                      25

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      45

                  </td>
                  <td align="right" class="border-left-0">

                      180%

                  </td>

                  <td align="right" class="border-right-0">

                      30

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      49

                  </td>
                  <td align="right" class="border-left-0">

                      163%

                  </td>

                  <td align="right" class="border-right-0">

                      35

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      52

                  </td>
                  <td align="right" class="border-left-0">

                      149%

                  </td>

                  <td align="right" class="border-right-0">

                      42

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      58

                  </td>
                  <td align="right" class="border-left-0">

                      138%

                  </td>

                  <td align="right" class="border-right-0">

                      50

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      59

                  </td>
                  <td align="right" class="border-left-0">

                      118%

                  </td>

                  <td align="right" class="border-right-0">

                      60

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      62

                  </td>
                  <td align="right" class="border-left-0">

                      103%

                  </td>

                  <td align="right" class="border-right-0">

                      75

                  </td>
                  <td align="right" class="border-right-0 border-left-0">

                      64

                  </td>
                  <td align="right" class="border-left-0">

                      85%

                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>

                  <td align="right" class="border-right-0">



                  </td>
                  <td align="right" class="border-right-0 border-left-0">



                  </td>
                  <td align="right" class="border-left-0">



                  </td>


            </tr>

          </tbody>
        </table>
      </div>

      <div id="indicator_modal_div" class="modal fade" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content" id="indicator_modal_content">

          </div> <!-- modal content -->
        </div>
    </div>

    <script>

        // Open the IndicatorUpdate Form in a modal
        $("#id_div_top_iptt_report").on("click", ".indicator-link", function (e) {
          e.preventDefault();
          let url = $(this).attr("href");
          url += "?modal=1";
          const programId = $(this).data("programid");

          $("#indicator_modal_content").empty();
          $("#modalmessages").empty();

          $("#indicator_modal_content").load(url);
          $("#indicator_modal_div").modal('show');


        });

        // Open the Results Records in a modal
        $("#id_div_top_iptt_report").on("click", ".indicator-ajax-popup", function (e) {
          e.preventDefault();
          const indicatorId = $(this).data('indicatorid');
          const url = `/indicators/results_table/${indicatorId}/0/?edit=false`;
          $("#indicator_modal_content").empty();
          $("#modalmessages").empty();
          $("#indicator_modal_content").load(url);
          $("#indicator_modal_div").modal('show');

        });

      </script>



<script>
    var validation_msgs = {};
    var mediaSize = window.matchMedia("(max-width: 575px)")
    var userLang = "";

    function setupPopupCalendar() {
        $('.monthPicker').datepicker({
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            dateFormat: 'yy-mm-dd',
            beforeShow(input, inst){
                // move date picker popup div inside modal dialog(fix for firefox)
                $(input).parent().append($('#ui-datepicker-div'));
                $('#ui-datepicker-div').hide();
            }
            /*
            onClose: function (dateText, inst) {
                const field = $(this);
                field.datepicker("setDate", new Date(inst.selectedYear, inst.selectedMonth, 1));
                $(this).datepicker("widget").find(".ui-datepicker-calendar").hide();
            },
            */
        }).focus(function(){
            const field = $(this);
            // hide the days part of the calendar
            $(".ui-datepicker-calendar").hide();
            // hide the "Today" button
            $("#ui-datepicker-div button.ui-datepicker-current").hide();
            $("#ui-datepicker-div").position({
                my: "left top",
                at: "left bottom",
                of: $(this)
            });
            // detach it from the field so that onclose the field is not populated automatically
            $('.ui-datepicker-calendar').detach();
            $('.ui-datepicker-close').click(function() {
                // this is only called when the done button is clicked.
                const month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                const year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                field.datepicker('setDate', new Date(year, month, 1));
                field.trigger('change');
            });
        });
    }

    $( document ).ready(function() {
        show_hide_frequency_fields();
        setupPopupCalendar();
        if ($("#id_objectives option").length < 1) {
            $("#id_objectives").attr("disabled", true)
        }

    });

    $("#indicator_modal_div").on('shown.bs.tab', function() {
        show_hide_frequency_fields();
        setupPopupCalendar();
    });


    // when a user clicks the 'Attach evidence' button in the indicator from.
    $("#indicator_modal_content, #indicator_form").on("click", "#id_add_evidence_btn", function(e){
        alert('Not implemented yet!');
    });

    $("#indicator_modal_content, #indicator_form").on("click", "a.btn-delete", function(e){
        e.preventDefault();
         // $(e.target).closest("tr").prev("tr").find("a").show(); //.css("display", "block");
        var url = $(this).attr('href');
        var id = url.split('/')[url.split('/').length - 2];
        var currentRow = $(e.target).closest("tr");
        var dataCount = parseInt(currentRow.data("collectedCount"));
        if ( dataCount != NaN && dataCount > 0) {
            if (!confirm(`Warning: This action cannot be undone. Removing this target means that ${dataCount} data record/s will no longer have targets associated with them. \u005Cn\u005CnProceed anyway?`)) {
                dataCount = NaN;
                return;
            }
        }
        var prevDeleteBtn = currentRow.prev("tr").find("a");

        if (id == 'undefined' || id == undefined) {
            currentRow.remove();
            if ($('#periodic_targets_table tbody tr.periodic-target').length == 0) {
                $("#id_div_periodic_tables_placeholder").empty();
                reset_frequency_fields();
            }
            updateAggregateRowValueAndLabel()
            prevDeleteBtn.show();
            return;
        }

        $.post(url)
            .done(function(data, textStatus, jqXHR){
                if (data.status == "success") {
                    currentRow.remove();
                    prevDeleteBtn.show();
                    $("#indicator_update_form").data('indicatorchanged', true);
                    updateAggregateRowValueAndLabel()
                    if ($('#periodic_targets_table tbody tr.periodic-target').length == 0) {
                        $("#id_div_periodic_tables_placeholder").empty();
                        reset_frequency_fields();
                    }
                } else {
                    createAlert("danger", data.msg, true, "#modalmessages");
                    $('#indicator_modal_div').animate({ scrollTop: 0 }, 'slow');
                }
            });
    });


    $("#indicator_form").on("submit", "#indicator_update_form", function(e){
        e.preventDefault();
        if (validateForm() == false) {
            showValidations("#alerts");
            return;
        }
        submitForm(this);
    });

    // Intercept IndicatorUpdate form submission and then use ajax to submit it.
    $("#indicator_modal_content").on("submit", "#indicator_update_form", function(e){
        e.preventDefault();
        if (validateForm() == false) {
            showValidations("#modalmessages");
            return;
        }
        submitForm(this);
    });


    $("#indicator_modal_content, #indicator_form").on("keyup keypress", "#indicator_update_form", function(e){
        var keyCode = e.keyCode || e.which;
        if (keyCode === 13 ){
            e.preventDefault();
            return false;
        }

    });

    $("#indicator_modal_content, #indicator_form").on("click", "#id_create_targets_btn", function(e) {
        e.preventDefault();
        if (validateForm() == false) {
            showValidations("#modalmessages");
            return;
        }
        $(this).attr("disabled", true);
        submitForm($("#indicator_update_form"));
    });


    function createPeriodicTargetRow(pt, target_frequency, isLastIteration, rowNum) {
        var markup = `
                <tr class="periodic-target">
                    <td class="align-middle pr-0" style="width: 50px; text-align: center;">
                        <a href="/indicators/periodic_target_delete/${pt.id}/" class="btn-delete" style="text-align: center; color:red; display: ${(isLastIteration && target_frequency != 2 || target_frequency == 8) ? 'block' : 'none'}">
                            <i class="fas fa-times"></i>
                        </a>
                    </td>

                    <td class="align-middle pr-0">
                        ${(target_frequency != 8) ? `
                            <strong>${pt.period }</strong></div>
                            <div>${formatDate(pt.start_date)} ${ pt.start_date ? '-' : ''} ${formatDate(pt.end_date)}</div>`
                            :
                            `<input type="text" name="${pt.period}" placeholder="Enter event name" value="${(rowNum == 0) ? pt.period : (pt.id ? pt.period : '') }" class="form-control input-text">
                                <span style="margin:0px;" class="help-block"> </span>`
                        }
                    </td>

                    <td class="align-middle" align="right" width="150px">
                        <span class=${ $("#id_unit_of_measure_type_1").is(":checked")?"input-symbol-percent":""}>
                            <input
                                type="number"
                                id="pt-${pt.id}"
                                value="${parseFloat(pt.target).toFixed(2).replace(/[.,]00$/, "")}"
                                data-start-date="${formatDate(pt.start_date)}"
                                data-end-date="${formatDate(pt.end_date)}"
                                data-periodictarget="pt"
                                name="${pt.period}"
                                placeholder="Enter target"
                                class="form-control input-value">
                        </span>
                            <span id="hint_id_pt_${pt.period}" style="margin:0px;" class="help-block"> </span>
                    </td>
                </tr>
            `;
        return markup;
    }

    // delete periodic_target
    $("#indicator_modal_content, #indicator_form").on("click", "#id_delete_targets_btn", function(e) {
        e.preventDefault();
        var form_url = $("#indicator_update_form").attr('action');
        var indicator_id = form_url.split('/').slice(-2, -1)[0];
        var dataCountAttribute = $("#periodic_targets_table tr").attr("data-collected-count");
        var msg = '';
        if (typeof dataCountAttribute !== typeof undefined && dataCountAttribute !== false) {
            msg = 'Warning: This action cannot be undone. Any data records assigned to a target will need to be reassigned.\u005Cn\u005Cn Are you sure you want to remove all targets?';
        } else {
            msg = 'Warning: This action cannot be undone. Are you sure you want to remove all targets?';
        }
        if (!confirm(msg)){
            return;
        }

        $.post('/indicators/periodic_target_deleteall/' + indicator_id + '/true/', function(data){
            var res = $.parseJSON(data);
            if (res['status'] == 'success') {
                $("#id_div_periodic_tables_placeholder").empty();
                reset_frequency_fields();
                show_hide_frequency_fields();
                $("#indicator_update_form").data('indicatorchanged', true);
            }

        });
    });

    // add new periodic target
    $("#indicator_modal_content, #indicator_form").on("click", "#addNewPeriodicTarget", function(e) {
        e.preventDefault();
        var numTargets = $("#periodic_targets_table tbody tr").length-1;
        var form_url = $("#indicator_update_form").attr('action');
        var indicator_id = form_url.split('/').slice(-2, -1)[0]
        $.get('/indicators/periodic_target_generate/' + indicator_id + '/?numTargets=' + numTargets, function(data){

            var pt = $.parseJSON(data);
            var isLastIteration = true;
            var target_frequency = $("#id_target_frequency").val();
            var markup = createPeriodicTargetRow(pt, target_frequency, isLastIteration);
            $("#periodic_targets_table tbody tr:nth-last-child(2)").before(markup);
        });

    });

    function submitForm(form) {
        var numDataPoints = parseInt($("#numDataPoints").text());
        var initalTargetFrequency = parseInt($("#initialTargetFrequencyValue").text());
        var target_frequency = $("#id_target_frequency").val();

        if (numDataPoints > 0 && initalTargetFrequency == 1 && target_frequency != 1) {
            if (!confirm(`Warning: This action cannot be undone. If we make these changes, ${numDataPoints} data record/s will no longer be associated with the Life of Program target, and will need to be reassigned to new targets. \u005Cn\u005CnProceed anyway?`)) {
                initalTargetFrequency = undefined;
                return;
            }
        }
        // $("#id_create_targets_btn").attr("disabled", true);
        var submitBtnName = $(form).find("input[type=submit]:focus" );
        var form_url = $(form).attr('action');
        var form_data = $(form).serialize();
        // mark that the form data has changed so that when the modal is closed the list view can be updated
        $(form).data('indicatorchanged', true);

        var periodic_targets = [];

        // Collect all existing periodic_targets into an array.
        $('#periodic_targets_table tbody tr.periodic-target').each(function () {
            var $this = $(this);
            var values = [];
            var eventNameElement = $($this.find('input[type=text]'));
            var targetValueSelector = $($this.find('input[type=number]'));

            var pt_id;
            var pt_name;
            try {
                pt_id = parseInt(targetValueSelector.attr('id').split('-')[1]);
                if (!$.isNumeric(pt_id)) { pt_id = 0; }
            } catch (err) {
                pt_id = 0;
            }

            if (eventNameElement.length > 0) {
                pt_name = eventNameElement.val();
            } else {
                pt_name = targetValueSelector.attr('name');
            }

            var pt_value = targetValueSelector.val();
            var start_date = targetValueSelector.data("startDate");
            var end_date = targetValueSelector.data("endDate");

            periodic_targets.push({'id': pt_id, 'period': pt_name, 'target': pt_value, 'start_date': start_date, 'end_date': end_date } );
        });
        // if there are errors in periodic targets then do not submit the form
        if ($("#id_div_periodic_tables_placeholder input").parent().hasClass('has-error')) { return; }

        // If there aren't any existing periodic_targets then set the flag to generate them.
        if ($.isEmptyObject(periodic_targets)) {
            form_data += "&periodic_targets=generateTargets";
        } else {
            form_data += "&periodic_targets=" + JSON.stringify(periodic_targets);
        }

        // Set is_cumulative if it's not already set
        if (form_data.indexOf('is_cumulative') == -1) {
            form_data += "&is_cumulative=3"
        }

        $("#modalmessages").html("<img src='/static//img/ajax-loader.gif'>  <span>Saving form... please wait.</span>");
        $.ajax({
            method: 'POST',
            url: form_url,
            data: form_data,
            global: false, }
        ).done(function(data, textStatus, jqXHR) {
            var alertsElement = "#alerts";
            if ( $("#modalmessages").length) {
                alertsElement = "#modalmessages";
            }
            // if there are any erros show them and then STOP
            if (jqXHR.getResponseHeader('error') == "True") {
                //$("#modalerrors").html(data);
                createAlert("danger", data, true, alertsElement);
                return;
            }

            $(alertsElement).html('');

            createAlert("success", "Success, form data saved.", true, alertsElement);

            var jsondata = $.parseJSON(data);
            var indicator = $.parseJSON(jsondata["indicatorjson"])[0];
            var targets_sum = jsondata["targets_sum"];
            var targets_avg = jsondata["targets_avg"];
            var update_indicator_row = jsondata["update_indicator_row"];
            var content = jsondata["content"];
            var remove_missing_targts_link = jsondata["remove_missing_targts_link"];
            $(form).data('update_indicator_row', parseInt(update_indicator_row));

            $("#initialTargetFrequencyValue").text(indicator.fields.target_frequency);
            if ($("#id_target_frequency").val() != 1) {
                $("#id_div_periodic_tables_placeholder").empty();
                $("#id_div_periodic_tables_placeholder").append(content);
                if (indicator.fields.unit_of_measure_type == 1) {
                    $("#id_span_targets_sum").text(parseFloat(targets_sum).toFixed(2).replace(/[.,]00$/, ""));
                } else {
                    $("#id_span_targets_sum").text(parseFloat(targets_avg).toFixed(2).replace(/[.,]00$/, ""));
                }

            }
            if ($('#indicator_modal_div').length == 1) {
                // for the modal version;
                $("#indicator_modal_div").animate({ scrollTop: 0 }, 'slow');
            } else {
                // for the non-modal version;
                $("html, body").animate({ scrollTop: 0 }, "slow");
            }

            show_hide_frequency_fields(true);
            toggleTargetsSumOrAvgRow()
            if ($("#id_unit_of_measure_type_1").is(":checked")) {
                show_hide_cummulative_inputs('percent')
            }
            else {
                show_hide_cummulative_inputs('number')
            }

            if (remove_missing_targts_link == true) {
                $(`#id_missing_target_periods_for_indicator_id_${indicator.pk}`).html('');
            }
        });
    }


    function reset_frequency_fields() {
        $("#id_target_frequency").val('');
        $("#id_target_frequency option:not(:selected)").attr("disabled", false);
        $("#id_target_frequency").attr("readonly", false);
        $("#id_create_targets_btn").attr("disabled", false);
        $("#id_target_frequency_num_periods").val(1);
        $("#id_target_frequency_custom").val('');
    }


    function show_hide_frequency_fields(lock = false) {
        // set the text for the 'create new target' button.
        var label = '<i class="fas fa-plus-circle"></i> ' + getNewTargetBtnLabel($("#id_target_frequency").val());
        $("#addNewPeriodicTarget").html(label);
        var selected_option = parseInt($("#id_target_frequency").find("option:selected").val()) || 0;
        if ( (lock == true || $('#id_target_frequency').attr('readonly'))
                 && selected_option != 1) {
            $("#id_target_frequency option:not(:selected)").attr("disabled", true);
            $("#id_target_frequency").attr("readonly", true);
            $("#id_create_targets_btn").attr("disabled", true);
            $("#div_id_target_frequency_num_periods").hide();
            $("#div_id_target_frequency_custom").hide();
            lock = true;
        }
        if (selected_option == 1 || selected_option == 0) {
            $("#div_id_create_targets_btn").hide();
        } else {
            if ($("#id_div_periodic_tables_placeholder").children().length > 0) {
                $("#id_delete_targets_btn").show();
            } else {
                $("#id_delete_targets_btn").hide();
            }

            if (selected_option == 8) {
                $("#div_id_target_frequency_num_periods label").text("Number of events*");
                $("#div_id_create_targets_btn").show();
            } else {
                $("#div_id_target_frequency_num_periods").hide();
                $("#div_id_create_targets_btn").show();
            }
        }



        if (lock == false) {
            if (selected_option == 1 ||
                selected_option == 2 ||
                selected_option == 0) {
                $("#div_id_target_frequency_num_periods").hide();
                $("#div_id_target_frequency_custom").hide();
                $("#id_target_frequency_custom").val('');

            } else if (selected_option == 8) {
                $("#div_id_target_frequency_custom").show();
                $("#div_id_target_frequency_num_periods").show();
            } else {
                $("#div_id_target_frequency_num_periods").hide();
                $("#div_id_target_frequency_custom").hide();
                $("#id_target_frequency_custom").val('');
            }
        }
    }

    function getNewTargetBtnLabel(index) {
        var label = '';
        if (index == 3 ) {
            label += 'Add a year';
        } else if (index == 4) {
            label += 'Add a semi\u002Dannual period';
        } else if (index == 5) {
            label += 'Add a tri\u002Dannual period';
        } else if (index == 6) {
            label += 'Add a quarter';
        } else if (index == 7) {
            label += 'Add a month';
        } else if (index == 8) {
            label += 'Add an event';
        } else {
            label = 'Add a target';
        }
        return label;
    }
    $("#indicator_modal_content, #indicator_form").on("change blur", "#id_target_frequency", function(e){
      if ($("#id_target_frequency option:selected").text().indexOf("---") < 0) {
        $("#id_target_frequency").removeClass('is-invalid');
        $("#validation_id_target_frequency").text(" ");
        $("#div_id_target_frequency").removeClass('marginbottom-225');
        $("#div_id_target_frequency").addClass('mb-3');
      }
      else {
        $("#div_id_target_frequency").addClass('marginbottom-225');
        $("#div_id_target_frequency").removeClass('mb-3');
      }
      show_hide_frequency_fields();
    });


    function reset_baseline_errors(){
        $("#id_baseline").removeClass('is-invalid');
        $("#id_baseline_na").removeClass('is-invalid');
        $("#validation_id_baseline").html("");
    }

    function validate_baseline() {
        const baseline = $("#id_baseline");
        const baseline_na = $("#id_baseline_na");
        let errMsg = undefined;

        if (baseline_na.is(':checked') == true) {
            reset_baseline_errors();
            return true;
        }

        if (!baseline.val()) {
            errMsg = "Please complete this field. Your baseline can be zero.";
        } else if (!$.isNumeric(baseline.val()) || baseline.val() < 0 ) {
            errMsg = "Please complete this field. Your baseline can be zero.";
            return false;
        }
        if (errMsg){
            baseline.addClass('is-invalid');
            // baseline_na.addClass('is-invalid');
            $("#validation_id_baseline").html(errMsg);
        } else {
            reset_baseline_errors();
            errMsg = undefined;
            return true;
        }
    }

    function validate_loptarget() {
        const lop = $("#id_lop_target");
        let errMsg = undefined;
        if (!lop.val()) {
            errMsg = "Please enter a number larger than zero.";
        } else if (!$.isNumeric(lop.val()) || lop.val() <= 0) {
            errMsg = "Please enter a number larger than zero with no letters or symbols. If your target is a percentage, describe it in the unit of measure field.";
        }

        if (errMsg) {
            lop.addClass('is-invalid');
            $("#validation_id_lop_target").text(errMsg);
            return false;
        } else {
            lop.removeClass('is-invalid');
            $("#validation_id_lop_target").text(" ");
            errMsg = undefined;
            return true;
        }
    }

    function validateForEmptyField(fieldName) {
        const field = $("#" + fieldName);
        if ($.isEmptyObject(field.val())) {
            $(field).addClass('is-invalid');
            $("#validation_" + fieldName).text("Please complete this field.");
            return false;
        } else {
            $(field).removeClass('is-invalid');
            $("#validation_" + fieldName).text(" ");
            return true;
        }
    }

    function validateNumPeriods() {
        const fieldId = "id_target_frequency_num_periods";
        const numPeriodsField = $("#" + fieldId);
        let errMsg = undefined;
        if (numPeriodsField.is(":visible")) {
            if (numPeriodsField.val() > 12) {
                errMsg = "You can start with up to 12 targets and add more later.";
            } else if (!numPeriodsField.val()) {
                errMsg = "Please complete this field.";
            } else if (numPeriodsField.val() < 0) {
                errMsg = "Please enter a number larger than zero.";
            }

            if (errMsg) {
                numPeriodsField.addClass('is-invalid');
                $("#div_id_target_frequency_num_periods").removeClass('mb-3');
                $("#div_id_target_frequency_num_periods").addClass('mb-5');
                $("#validation_" + fieldId).text(errMsg);
                return false;
            } else {
                numPeriodsField.removeClass('is-invalid');
                $("#validation_" + fieldId).text(" ");
                errMsg = undefined;
                return true;
            }
        }
    }

    function validatePeriodicTargets(){
        let errorFlag = false;
        // validate target values (number fields)
        $("#periodic_targets_table input[type=number]").each(function(){
            if ($(this).attr('id').substr(0, 2) == "pt" ) {
                if ($(this).val()) {
                    $(this).removeClass('is-invalid');
                } else {
                    $(this).addClass('is-invalid');
                    errorFlag = true;
                }
            }
        });

        // validate target labels (text fields)
        $("#periodic_targets_table input[type=text]").each(function(){
            if ($(this).val()) {
                $(this).removeClass('is-invalid');
            } else {
                $(this).addClass('is-invalid');
                errorFlag = true;
            }
        });

        if (errorFlag) {
            $("#id_pt_errors").html(`<span class="target-value-error"><small>${getPTMessage()}</small></span>`);
        }
    }


    function getPTMessage () {
        if ($("#periodic_targets_table input[type=text]").length > 0){
            return ("Please enter a name and target number for every event. Your target value can be zero.");
        }
        else {
            return ("Please enter a target value. Your target value can be zero.");
        }
    }


    function showValidations(messagesDiv) {
        var msg = '';
        $.each(validation_msgs, function(k,v) {
            msg += v + '<br>';
        });
        $(messagesDiv).empty();
        if (!jQuery.isEmptyObject(validation_msgs)) {
            createAlert('danger', msg, false, messagesDiv);
        }
        validation_msgs = {};
    }

    function validateForm() {
        var validationsTargetTab = true;
        var validationsPerformanceTab = true;
        if  (validate_baseline() == false ) {
            validationsTargetTab = false
        }
        if (validate_loptarget() == false ) {
            validationsTargetTab = false;
        }
        if (validateForEmptyField("id_unit_of_measure") == false ) {
            validationsTargetTab = false;
        }
        if ($("#id_target_frequency_custom").is(":visible")){
          if (validateForEmptyField("id_target_frequency_custom") == false) {
            $("#div_id_target_frequency_custom").addClass('mb-5')
            $("#div_id_target_frequency_custom").removeClass('mb-3')
            validationsTargetTab = false;
          }
          else {
            $("#div_id_target_frequency_custom").addClass('mb-3')
            $("#div_id_target_frequency_custom").removeClass('mb-5')
          }
        }
        if (validateForEmptyField("id_target_frequency") == false) {
            validationsTargetTab = false;
            $("#div_id_target_frequency").addClass("marginbottom-225")
            $("#div_id_target_frequency").removeClass("mb-3")
        }
        if (validateNumPeriods() == false) {
            validationsTargetTab = false;
        }

        if (validatePeriodicTargets() == false) {
            validationsTargetTab = false;
        }

        // validate periodic targets
        if ($("#id_div_periodic_tables_placeholder input").hasClass('is-invalid')) {
            validationsTargetTab = false;
        }

        if (validationsTargetTab == false) {
            validation_msgs['target'] = 'Please complete all required fields in the Targets tab.';
        } else {
            delete validation_msgs['target'];
        }

        /* validate fields from the performance tab */
        if (validateForEmptyField("id_name") == false) {
            validationsPerformanceTab = false
            $("#div_id_name").addClass("marginbottom-225")
            $("#div_id_name").removeClass("mb-3")
        }
        else {
          $("#div_id_name").addClass("mb-3")
          $("#div_id_name").removeClass("marginbottom-225")
        }
        if (validationsPerformanceTab == false) {
            validation_msgs['performance'] = 'Please complete all required fields in the Summary tab.';
        } else {
            delete validation_msgs['performance'];
        }
        return (validationsTargetTab && validationsPerformanceTab) ? true: false;
    }

    $("#indicator_modal_content, #indicator_form").on("keypress", "input[type=number]", function(e){
        if (e.which == 69 || e.which == 101){ //69 = e | 101 = E
            e.preventDefault();
        }
    });

    $("#indicator_modal_content, #indicator_form").on("input", "#periodic_targets_table input[type=number]", function(e){
        if ($(this).val() && $(this).val() >= 0) {
            $(this).removeClass('is-invalid');
            $("#id_pt_errors").text('');
        } else {
            $(this).addClass('is-invalid');
        }

        if ($("#id_div_periodic_tables_placeholder input[type=number], input[type=text]").hasClass("is-invalid") ) {
            $("#id_pt_errors").html(`<span class="target-value-error"><small>${getPTMessage()}</small></span>`);
        }
    });

    $("#indicator_modal_content, #indicator_form").on("input", "#periodic_targets_table input[type=text]", function(e){
        if ($(this).val()) {
            $(this).removeClass('is-invalid');
            $("#id_pt_errors").text('');
        } else {
            $(this).addClass('is-invalid');
        }
        if ($("#id_div_periodic_tables_placeholder input[type=text], input[type=number]").hasClass("has-error") ) {
            $("#id_pt_errors").html(`<span class="target-value-error"><small>${getPTMessage()}</small></span>`);
        }
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_unit_of_measure", function(e){
        validateForEmptyField("id_unit_of_measure");
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_target_frequency", function(e){
        validateForEmptyField("id_target_frequency");
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_lop_target", function(e){
        validate_loptarget();
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_baseline", function(e){
        $("#id_baseline_na").prop('checked', false);
        validate_baseline();
    });

    $("#indicator_modal_content, #indicator_form").on("input", "#id_baseline", function(e){
        $("#id_baseline_na").prop('checked', false);
    });

    $("#indicator_modal_content, #indicator_form").on("change", "#id_baseline_na", function(e){
        $("#id_baseline").val('');
        if (!$(this).is(':checked')){
            validate_baseline()
        } else {
            reset_baseline_errors();
        }
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_target_frequency_custom", function(e){
        var is_valid = validateForEmptyField("id_target_frequency_custom");
        if (!is_valid) {
          $("#div_id_target_frequency_custom").addClass('mb-5')
          $("#div_id_target_frequency_custom").removeClass('mb-3')
        }
        else {
          $("#div_id_target_frequency_custom").addClass('mb-3')
          $("#div_id_target_frequency_custom").removeClass('mb-5')
        }
    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_target_frequency_num_periods", function(e){
        validateNumPeriods();

    });

    $("#indicator_modal_content, #indicator_form").on("blur", "#id_name", function(e){
        var is_valid = validateForEmptyField("id_name");
        if (!is_valid) {
          $("#div_id_name").addClass('marginbottom-225')
          $("#div_id_name").removeClass('mb-3')
        }
        else {
          $("#div_id_name").addClass('mb-3')
          $("#div_id_name").removeClass('marginbottom-225')
        }
    });

    // Allow users to click an IPTT table row to highlight it
    $("#iptt_table tbody tr").on("click", function(e){
        // Don't highlight the row if the user is clicking on the popup or gear icons
        if(!['BUTTON', 'path', 'svg', 'a'].includes(e.target.tagName)) {
            if ($(this).hasClass('row-highlight')){
                $("#iptt_table tbody tr").removeClass('row-highlight');
            }
            else{
                $("#iptt_table tbody tr").removeClass('row-highlight');
                $(this).addClass('row-highlight');
            }
        }
    })

</script>

  </main>

            </div>

        </div><!-- .container collapse -->

        <div id = "ajaxloading" class="modal ajax_loading"></div>
        <div id="footer">
            <!-- Sticky Footer -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6 text-left">
                        <div class="navbar-expand-sm">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a href="/" class="nav-link help-link"><b>Tola</b>Data</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="navbar-expand-md">
                            <ul class="navbar-nav justify-content-end">
                                <li class="nav-item">
                                    <a href="https://learn.mercycorps.org/site/tola/index.php/TOLA:Section_01/en"
                                    class="nav-link help-link"
                                    target="_blank">Documentation</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://thehub.mercycorps.org/node/7768"
                                    class="nav-link help-link"
                                    target="_blank">FAQ</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://learn.mercycorps.org/site/tola/index.php/TOLA:Section_06/en"
                                    class="nav-link help-link"
                                    target="_blank">Feedback</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- .footer collapse -->

        <script src="/static/js/jquery-ui.min.js"></script>

        <script src="/static/js/popper.min.js"></script>

        <script src="/static/js/bootstrap.min.js"></script>

        <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>


        <script type="text/javascript" src="/static/js/datatables.min.js"></script>

        <script type="text/javascript" src="/static/js/select2.min.js"></script>

        <!-- bootstrap multiselect -->
        <script type="text/javascript" src="/static/js/bootstrap-multiselect.js?v=ww"></script>
        <link href="/static/css/bootstrap-multiselect.css?v=ww" rel="stylesheet" type="text/css">

        <!-- Add JQuery UI language files -->
        <script type="text/javascript" src="/static/js/datepicker-fr.js"></script>
        <script type="text/javascript" src="/static/js/datepicker-es.js"></script>



        <script type="text/javascript">
            var userLang = "en";
            $(document).ready(function() {
                $.datepicker.setDefaults( $.datepicker.regional[ userLang ] );
            });
        </script>
        <!-- End JQuery UI language files -->









    </body>
</html>
