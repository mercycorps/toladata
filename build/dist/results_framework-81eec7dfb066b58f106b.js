(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"4L+s":function(e,t,r){"use strict";r.d(t,"b",function(){return m}),r.d(t,"a",function(){return v});var o=r("q1tI"),a=r.n(o),n=r("i8i4"),l=r.n(n);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=f(i);return t=a?(e=f(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==s(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(r):o}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(){u(n,a.a.Component);var e,t,r,o=d(n);function n(e){var t;return c(this,n),(t=o.call(this,e)).placement=e.placement||null,t.popoverRef=e.innerRef||a.a.createRef(),t.iconClass=e.iconClass||"far fa-question-circle",t.iconStyle=e.iconStyle||{},t.linkStyle={},e.linkHeight&&(t.linkStyle.height=e.linkHeight),t}return e=n,(t=[{key:"render",value:function(){return a.a.createElement("a",{tabIndex:"0",style:this.linkStyle,"data-toggle":"popover","data-trigger":"focus","data-html":"true","data-placement":this.placement,"data-content":this.props.content,className:this.props.className,ref:this.popoverRef},a.a.createElement("i",{"aria-label":this.props.ariaText,style:this.iconStyle,className:this.iconClass}))}}])&&i(e.prototype,t),r&&i(e,r),n}(),v=function(){u(i,a.a.Component);var n=d(i);function i(){var t;c(this,i);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(t=n.call.apply(n,[this].concat(r))).popoverName="base",t.componentDidMount=function(){t.bodyClickHandler=function(e){0==$("#".concat(t.popoverName,"_popover_content")).parent().find($(e.target)).length&&$(t.refs.target).popover("hide")};function e(){$("body").on("click",t.bodyClickHandler),$(t.refs.target).popover("update").on("hide.bs.popover",function(){$("body").off("click",t.bodyClickHandler)})}$(t.refs.target).popover({content:'<div id="'.concat(t.popoverName,'_popover_content"></div>'),html:!0,placement:"bottom"}).on("shown.bs.popover",function(){l.a.render(t.getPopoverContent(),document.querySelector("#".concat(t.popoverName,"_popover_content")),e)})},t.getPopoverContent=function(){throw new Error("not implemented")},t}return i}()},"4a4Y":function(e,t,r){"use strict";r.d(t,"a",function(){return o});function Y(e){var t=(0<arguments.length&&void 0!==e?e:{}).custom_rfc_options,r=(void 0===t?null:t)||u.h;if(!r)return"";var o=document.createElement("section");o.classList.add("pnotify__reason-for-change");var n=document.createElement("div");n.classList.add("form-group");var i=document.createElement("label");i.appendChild(document.createTextNode(gettext("Reason for change"))),i.htmlFor="reasons_for_change_select",n.appendChild(i);var a=document.createElement("select");a.name="reasons_for_change",a.id="reasons_for_change_select",a.setAttribute("multiple",""),a.classList.add("form-control");for(var l=0;l<r.length;l++){var s,c=document.createElement("option");c.value=r[l].value,c.label=r[l].label,c.text=r[l].label,l==r.length-1&&((s=document.createElement("option")).setAttribute("data-role","divider"),a.appendChild(s)),a.appendChild(c)}return n.appendChild(a),o.appendChild(n),o}var u=r("v38i"),o=function(e){var t=0<arguments.length&&void 0!==e?e:{},r=t.header,o=void 0===r?null:r,n=t.show_icon,i=void 0===n||n,a=t.message_text,l=void 0===a?null:a,s=t.preamble,c=void 0===s?null:s,u=t.on_submit,p=void 0===u?function(){}:u,d=t.on_cancel,f=void 0===d?function(){}:d,m=t.rfc_required,v=void 0===m||m,h=t.rfc_options,b=void 0===h?null:h,g=t.rationale_required,y=void 0===g||g,S=t.include_rationale,_=void 0!==S&&S,E=t.validation_type,C=void 0===E?0:E,T=t.showCloser,w=void 0===T||T,O=t.confirm_text,x=void 0===O?gettext("Ok"):O,k=t.cancel_text,N=void 0===k?gettext("Cancel"):k,j=t.context,L=void 0===j?null:j,P=t.notice_type,I=void 0===P?"notice":P,A=(t.blocking,t.self_dismissing),D=void 0!==A&&A,F=t.dismiss_delay,R=void 0===F?8e3:F,B="";i&&(B='<i class="fas '.concat({error:"fa-exclamation-triangle",info:"fa-info-circle",success:"fa-check-circle",notice:"fa-exclamation-triangle"}[I],'"></i>'));var z=o||B?'<header class="pnotify__header">\n            <h4>\n                '.concat(B,"\n                ").concat(o||"","\n            </h4>\n        </header>"):"",K=c?'<section class="pnotify__preamble">\n            <p><b>'.concat(c,"</b></p>\n        </section>"):"",V=l?'<section class="pnotify__message">\n            <p>'.concat(l,"</p>\n        </section>"):"",M="";null!==b&&(M=Y({custom_rfc_options:!0===b?null:b}).outerHTML);var q=0<M.length?"<label>".concat(gettext("Details"),"</label>"):"",H=_?'<section class="pnotify__rationale">\n            <div class="form-group">\n                '.concat(q,'\n                <textarea class="form-control" name="rationale" />\n            </div>\n        </section>'):"",U="\n        ".concat(z,"\n        ").concat(K,"\n        ").concat(V,"\n        ").concat(M,"\n        ").concat(H,"\n    "),W={text:x,primary:!0,addClass:"btn-sm btn-"+{error:"danger",info:"info",success:"success",notice:"primary"}[I],click:function(e){var t=!0,r=$(e.refs.elem).find('textarea[name="rationale"]');r.parent().find(".invalid-feedback").remove();var o=r.val()?r.val().trim():void 0,n=($(e.refs.elem).find('select[name="reasons_for_change"]').val()||[]).map(function(e){return parseInt(e)}),i=!1;switch(C){case 1:i=o||0<n.length&&-1==n.indexOf(1);break;case 0:default:i=(o||!_||!y)&&(0<n.length||!b||!v)}if(!i)return r.addClass("is-invalid"),r.parent().append('<div class="invalid-feedback">'+gettext("A reason is required.")+"</div>"),!1;r.removeClass("is-invalid"),p&&void 0===(t=p(o,n,C))&&(t=!0),t&&(document.getElementById("notification_blocking_div").style.display="none",e.close())}},J={text:N,addClass:"btn-sm",click:function(e){close=f(),void 0===close&&(close=!0),close&&(document.getElementById("notification_blocking_div").style.display="none",e.close())}},G=[];x&&G.push(W),N&&G.push(J);var Q=PNotify.alert({text:$('<div><form action="" method="post" class="form">'.concat(U,"</form></div>")).html(),textTrusted:!0,icon:!1,width:"350px",hide:D,delay:R,type:I,addClass:"program-page__rationale-form",stack:{overlayClose:!0,dir1:"right",dir2:"up",firstpos1:20,firstpos2:20,context:L},modules:{Buttons:{closer:w,closerHover:!1,sticker:!1},Confirm:{align:"flex-start",confirm:!0,buttons:G}}});$(".pnotify__reason-for-change select").multiselect({numberDisplayed:1,nSelectedText:" ".concat(gettext("selected")),nonSelectedText:gettext("None selected")}),f&&Q.on("click",function(e){var t;$(e.target).is(".ui-pnotify-closer *")&&(!(t=f())&&void 0!==t||(document.getElementById("notification_blocking_div").style.display="none",Q.close()))})}},Ez0T:function(e,t,r){"use strict";r.d(t,"d",function(){return b}),r.d(t,"a",function(){return g}),r.d(t,"c",function(){return y}),r.d(t,"b",function(){return S});var o=r("q1tI"),i=r.n(o),a=r("Cs6D"),n=r("VCnP"),l=r.n(n),s=0;function c(e){return s++,"".concat(0<arguments.length&&void 0!==e?e:"id").concat(s)}var u=r("v38i");function p(e,t){if(null==e)return{};var r,o=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),i=0;i<n.length;i++)r=n[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r]);return o}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function f(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function m(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach(function(e){var t,r,o;t=n,o=i[r=e],r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function v(e){var t=c("react-select"),r=e.formGroupClass||"form-row mb-3",o=e.labelClass||"col-form-label text-uppercase",n=e.selectClass||"form-control";return i.a.createElement("div",{className:r},i.a.createElement("label",{htmlFor:t,className:o},e.label),i.a.createElement("select",{onChange:e.update,value:e.value,id:t,className:n,disabled:e.disabled},e.options))}function h(e){return""==e.children?i.a.createElement("div",null):i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",{style:{margin:"3px 0px 0px 0px"}}),i.a.createElement("div",{className:"text-muted",style:{textTransform:"uppercase",paddingLeft:"4px",marginBottom:"2px"}},e.children))}var b=function(e){var t=c("react-select"),r=e.labelClasses||"col-form-label text-uppercase",o=e.formRowClasses||"form-row mb-3",n=e.selectClasses||"tola-react-select";return i.a.createElement("div",{className:o},i.a.createElement("label",{htmlFor:t,className:r},e.label),i.a.createElement(a.a,{onChange:e.update,value:e.value,id:t,className:n,isDisabled:e.disabled,options:e.options}))},g=function(e){var t=c("date-select"),r=e.options&&1==e.options.length&&void 0!==e.options[0].value?i.a.createElement("option",{value:e.options[0].value},e.options[0].label):e.options&&0<e.options.length&&e.options[0].options&&void 0!==e.options[0].options?e.options.map(function(e,t){return i.a.createElement("optgroup",{label:e.label,key:t},e.options.map(function(e){return i.a.createElement("option",{value:e.value,key:e.value},e.label)}))}):e.options.map(function(e,t){return i.a.createElement("option",{value:e.value,key:t},e.label)});return i.a.createElement("div",{className:"form-row mb-3"},i.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),i.a.createElement("select",{className:"form-control",id:t,value:e.value,onChange:e.update,disabled:e.disabled},r))},y=function(e){var t=c("multiselect"),r=!e.options||0==e.options.length||1==e.options.length&&null===e.options[0].value,o=r?{getDropdownButtonLabel:function(){return gettext("None available")},isDisabled:!0,menuIsOpen:!1,options:[]}:{isMulti:!0,options:e.options,getDropdownButtonLabel:function(e){if(!e.value)return gettext("None selected");if(Array.isArray(e.value)){var t=e.value.filter(function(e){return!e.noList});return 0==t.length?gettext("None selected"):1==t.length?t[0].label:"".concat(t.length,"  ").concat(gettext("selected"))}return e.value.label}},n={dropdownButton:function(e){return r?m(m({},e),{},{backgroundColor:"#E5E6E8",background:""}):e},option:function(e){return m(m({},e),{},{padding:"1px 12px",display:"inline-block"})},container:function(e){return m(m({},e),{},{backgroundColor:"#f5f5f5"})}};return i.a.createElement("div",{className:"form-row mb-2 tola-react-multiselect-row"},i.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),i.a.createElement(l.a,d({id:t,styles:n,formatOptionLabel:function(e){return i.a.createElement("div",{style:{display:"inline-block",float:"right",width:"90%"}},e.label)},components:{GroupHeading:h},value:e.value,onChange:e.update},o)))},S=function(e){var t=e.chainLabel,r=p(e,["chainLabel"]),o=[i.a.createElement("option",{value:u.d,key:1},t),i.a.createElement("option",{value:u.e,key:2},gettext("by Level"))];return i.a.createElement(v,d({label:gettext("Group indicators"),options:o},r))}},QTZG:function(e,t,r){"use strict";r.r(t);var o,n,i,a,l=r("q1tI"),h=r.n(l),s=r("i8i4"),c=r.n(s),u=r("okNM"),p=(r("qtBC"),r("WtQ/")),b=r("2vnA"),d=r("7O5W"),f=r("wHSu"),g=r("IP2g"),m=r("TSYQ"),y=r.n(m),v=r("Ez0T"),S=r("hzyr"),_=r("YJCA"),E=r("4L+s"),C=r("O6Fj"),T=r.n(C),w=r("Cs6D"),O=r("4a4Y");function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t,r){return t&&N(e.prototype,t),r&&N(e,r),e}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=D(i);return t=a?(e=D(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==x(o)&&"function"!=typeof o?A(r):o}}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}d.b.add(f.b,f.c,f.a);var F=function(){L(t,h.a.Component);var e=I(t);function t(){return k(this,t),e.apply(this,arguments)}return j(t,[{key:"render",value:function(){return h.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),t}(),R=function(){L(i,h.a.Component);var n=I(i);function i(){var t;k(this,i);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(t=n.call.apply(n,[this].concat(r))).onChange=function(e){t.props.onProgramObjectiveImport(e.value)},t}return j(i,[{key:"render",value:function(){var e=this.props.programObjectives;if(0===e.length)return null;var t=e.map(function(e){return{value:e.id,label:e.name}});return h.a.createElement("div",{className:"program-objective-import mb-3"},h.a.createElement(w.a,{placeholder:gettext("Import Program Objective"),onChange:this.onChange,value:"",className:"tola-react-select",options:t,isDisabled:this.props.isDisabled}),h.a.createElement("a",{href:"#",className:"program-objective-import__icon",tabIndex:"0","data-html":"true","data-toggle":"popover","data-placement":"bottom","data-trigger":"focus","data-content":gettext("Import text from a Program Objective. <strong class='program-objective-import__popover-strong-text'>Make sure to remove levels and numbers from your text, because they are automatically displayed.</strong>"),onClick:function(e){return e.preventDefault()}},h.a.createElement("i",{className:"far fa-question-circle"})))}}]),i}(),B=Object(u.b)("rootStore")(o=Object(u.c)(o=function(){L(i,h.a.Component);var n=I(i);function i(){var r;k(this,i);for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(r=n.call.apply(n,[this].concat(t))).deleteLevel=function(){r.props.rootStore.uiStore.setDisableCardActions(!0);var e=r.props.levelProps.tierName+" "+r.props.levelProps.ontologyLabel;Object(O.a)({header:gettext("Warning"),show_icon:!0,notice_type:"error",preamble:gettext("This action cannot be undone."),message_text:interpolate(gettext("Are you sure you want to delete %s?"),[e]),on_submit:function(){return r.props.rootStore.levelStore.deleteLevelFromDB(r.props.level.id)},on_cancel:function(){return r.props.rootStore.uiStore.setDisableCardActions(!1)}})},r.editLevel=function(){r.props.rootStore.uiStore.editCard(r.props.level.id)},r.buildIPTTUrl=function(e){var t="/indicators/iptt_report/".concat(r.props.rootStore.levelStore.program_id,"/timeperiods/?frequency=3&start=0&end=999");return e.forEach(function(e){return t+="&indicators="+e}),t},r}return j(i,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var o=this;if(this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.parent)<0&&null!=this.props.level.parent)return null;var e,t,r,n,i,a=[],l=this.props.levelProps.indicators.map(function(e){return e.id});0<l.length&&(e=gettext("All indicators linked to %s"),t=interpolate(e,["".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel)]),a.push('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(l),">").concat(t,"</a></li>"))),this.props.levelProps.tierName==this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0]||0<(r=this.props.levelProps.descendantIndicatorIds).length&&(r=r.concat(l),n=gettext("All indicators linked to %s and sub-levels"),i=interpolate(n,["".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel)]),a.unshift('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(r),">").concat(i,"</a></li>")));var s=this.props.levelProps.indicators.sort(function(e,t){return e.level_order-t.level_order}).map(function(e,t){var r="";return o.props.rootStore.levelStore.manual_numbering?o.props.rootStore.levelStore.manual_numbering&&e.number&&(r=e.number+": "):r=o.props.levelProps.ontologyLabel+String.fromCharCode(97+t)+": ",'<li class="nav-item level-card--iptt-links"><a href='.concat(o.buildIPTTUrl([e.id]),">").concat(r).concat(e.name,"</a></li>")}),a=a.concat(s),c='<ul class="nav flex-column">'.concat(a.join(""),"</ul>"),u=this.props.levelProps.indicators.length,p=interpolate(ngettext("%s indicator","%s indicators",u),[u]),d=null;this.props.levelProps.tierName!=Object(b.r)(this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0])&&0<this.props.rootStore.levelStore.levels.filter(function(e){return e.parent==o.props.level.id}).length&&(d=h.a.createElement(g.a,{className:this.props.rootStore.uiStore.disabledActionsOrActiveCard?"":"text-action",icon:0<=this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.id)?"caret-down":"caret-right"}));var f=d&&!this.props.rootStore.uiStore.disabledActionsOrActiveCard?"level-card__toggle":null,m=this.props.rootStore.uiStore.disabledActionsOrActiveCard?null:function(e){return o.props.rootStore.uiStore.updateVisibleChildren(o.props.level.id)},v=0===a.length||this.props.rootStore.uiStore.disableCardActions;return h.a.createElement("div",{className:"level-card level-card--collapsed",id:"level-card-".concat(this.props.level.id)},h.a.createElement("div",{className:f,onClick:m},d,h.a.createElement("span",{className:"level-card--collapsed__name"},h.a.createElement(F,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})," ",this.props.level.name)),h.a.createElement("div",{className:"level-card--collapsed__actions"},h.a.createElement("div",{className:"actions__top btn-row"},this.props.levelProps.canDelete&&h.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableCardActions||this.props.rootStore.uiStore.activeCard,className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},h.a.createElement("i",{className:"fas fa-trash-alt"}),gettext("Delete")),this.props.levelProps.canEdit&&h.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableCardActions,className:"btn btn-sm btn-link btn-text edit-button",onClick:this.editLevel},h.a.createElement("i",{className:"fas fa-edit"}),gettext("Edit"))),h.a.createElement("div",{className:"actions__bottom"},h.a.createElement("a",{tabIndex:"0",className:y()("btn btn-sm btn-link no-bold",{disabled:v}),"data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-html":"true",title:gettext("Track indicator performance"),"data-content":c},p))))}}]),i}())||o)||o,z=Object(u.b)("rootStore")(n=Object(u.c)(n=function(){L(r,h.a.Component);var t=I(r);function r(e){var i;return k(this,r),(i=t.call(this,e)).onDragEnd=function(e){var t=e.oldIndex,r=e.newIndex;i.indicatorWasReordered=!0;var o=i.indicators[t].id,n={value:r+1,name:r+1};i.changeIndicatorOrder(o,n)},i.changeIndicatorOrder=function(t,e){var r=i.indicators.find(function(e){return e.id==t}).level_order,o=e.value-1,n=i.indicators.slice();n.splice(o,0,n.splice(r,1)[0]),n.forEach(function(e,t){return e.level_order=t}),i.indicators.replace(n),i.props.rootStore.uiStore.activeCardNeedsConfirm=i.dataHasChanged,i.indicatorWasReordered=!0},i.updateSubmitType=function(e){i.submitType=e},i.saveLevel=function(e){e.preventDefault();function t(e){i.props.rootStore.levelStore.saveLevelToDB(i.submitType,i.props.level.id,i.indicatorWasReordered,{name:i.name,assumptions:i.assumptions,rationale:e,indicators:Object(b.r)(i.indicators)})}var r=0<i.indicators.length,o=0<i.props.level.assumptions.length&&i.assumptions!=i.props.level.assumptions,n=i.name!=i.props.level.name;r&&(o||n)?Object(O.a)({header:gettext("Reason for change"),show_icon:!0,message_text:gettext("Your changes will be recorded in a change log.  For future reference, please share your reason for these changes."),include_rationale:!0,rationale_required:!0,notice_type:"notice",on_submit:t,on_cancel:function(){return i.props.rootStore.uiStore.setDisableCardActions(!1)}}):t("")},i.cancelEdit=function(){1==i.props.rootStore.levelStore.levels.length&&"new"==i.props.level.id?i.clearData():i.props.rootStore.levelStore.cancelEdit(i.props.level.id)},i.clearData=function(){i.name="",i.assumptions=""},i.onFormChange=function(e){var t,r;e.preventDefault(),i[e.target.name]=e.target.value,i.name?($("#level-name-".concat(i.props.level.id)).removeClass("is-invalid"),$("#name-feedback-".concat(i.props.level.id)).remove()):((t=$("#level-name-".concat(i.props.level.id))).addClass("is-invalid"),r=gettext("Please complete this field."),t.after("<p id=name-feedback-".concat(i.props.level.id,' class="invalid-feedback">').concat(r,"</p>"))),i.props.rootStore.uiStore.activeCardNeedsConfirm=i.dataHasChanged},i.onProgramObjectiveImport=function(t){var e=i.props.rootStore.levelStore.programObjectives.find(function(e){return e.id===t});null!=e&&(i.name=e.name,i.assumptions=e.description)},i.submitType="saveOnly",i.indicatorWasReordered=!1,i.baseLevelString=JSON.stringify([e.level.name,e.level.assumptions]),i.baseIndicators=i.props.levelProps.indicators.slice().map(function(e){return Object(b.r)(e)}),Object(b.i)(A(i),{name:e.level.name,assumptions:e.level.assumptions,indicators:e.levelProps.indicators.sort(function(e,t){return e.level_order-t.level_order}),get dataHasChanged(){var e=this.baseLevelString+JSON.stringify(this.baseIndicators.sort(function(e,t){return e.id-t.id}));return JSON.stringify([this.name,this.assumptions])+JSON.stringify(Object(b.r)(this.indicators).sort(function(e,t){return e.id-t.id}))!=e},addIndicator:function(e){this.indicators.push(e),this.baseIndicators.push(e)},deleteIndicator:function(t){this.indicators=this.indicators.filter(function(e){return e.id!=t}),this.indicators.forEach(function(e,t){return e.level_order=t}),this.baseIndicators=this.baseIndicators.filter(function(e){return e.id!=t}),this.baseIndicators.forEach(function(e,t){return e.level_order=t})},updateIndicatorName:function(t,e){this.indicators.find(function(e){return e.id==t}).name=e,this.baseIndicators.find(function(e){return e.id==t}).name=e,this.props.rootStore.levelStore.updateIndicatorNameInStore(t,e)}},{addIndicator:b.d,deleteIndicator:b.d,updateIndicatorName:b.d}),i}return j(r,[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidMount",value:function(){var o=this;$('*[data-toggle="popover"]').popover({html:!0}),$("#indicator_modal_div").on("created.tola.indicator.save",function(e,t){var r={id:t.indicatorId,name:t.indicatorName,level:o.props.level.id,level_order:o.indicators.length};o.props.rootStore.levelStore.addIndicatorToStore(r),o.addIndicator(r)}),$("#indicator_modal_div").on("deleted.tola.indicator.save",function(e,t){o.props.rootStore.levelStore.deleteIndicatorFromStore(t.indicatorId),o.deleteIndicator(t.indicatorId)}),$("#indicator_modal_div").on("updated.tola.indicator.save",function(e,t){o.updateIndicatorName(t.indicatorId,t.indicatorName),t.levelId!=o.props.rootStore.uiStore.activeCard&&(t.levelId&&o.props.rootStore.levelStore.moveIndicatorInStore(t.indicatorId,t.levelId),o.deleteIndicator(t.indicatorId)),$('*[data-toggle="tooltip"]').tooltip("dispose"),$('*[data-toggle="tooltip"]').tooltip()})}},{key:"componentWillUnmount",value:function(){$("#indicator_modal_div").off("updated.tola.indicator.save"),$("#indicator_modal_div").off("deleted.tola.indicator.save"),$("#indicator_modal_div").off("created.tola.indicator.save")}},{key:"render",value:function(){var e=this,t=(Object(b.r)(this.indicators),this.props.rootStore.uiStore.disableCardActions),r=this.props.rootStore.levelStore.programObjectives,o="",o="new"==this.props.level.id?h.a.createElement("div",{className:"form-group"},h.a.createElement("button",{type:"submit",disabled:0==this.name.length||t,className:"btn btn-link btn-lg ",onClick:function(){e.updateSubmitType("saveAndEnableIndicators")}},h.a.createElement("i",{className:"fas fa-plus-circle"}),interpolate(gettext("Save %s and add indicators"),[this.props.levelProps.tierName]))):h.a.createElement(M,{level:this.props.level,tierName:this.props.levelProps.tierName,indicators:this.indicators,disabled:!this.name||"new"==this.props.level.id||this.props.rootStore.uiStore.disableCardActions,reorderDisabled:this.indicators.length<2||this.props.rootStore.uiStore.disableCardActions,changeFunc:this.changeIndicatorOrder,dragEndFunc:this.onDragEnd});return h.a.createElement("div",{className:"level-card level-card--expanded",id:"level-card-".concat(this.props.level.id)},h.a.createElement("div",{className:"d-flex justify-content-between"},h.a.createElement(F,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"}),h.a.createElement(R,{isDisabled:this.props.rootStore.uiStore.disableCardActions,programObjectives:r,onProgramObjectiveImport:this.onProgramObjectiveImport})),h.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},h.a.createElement("div",{className:"form-group"},h.a.createElement(T.a,{className:"form-control",id:"level-name-".concat(this.props.level.id),name:"name",value:this.name||"",disabled:this.props.rootStore.uiStore.disableCardActions,autoComplete:"off",rows:3,onChange:this.onFormChange,maxLength:500})),h.a.createElement("div",{className:"form-group"},h.a.createElement("label",{htmlFor:"assumptions"},gettext("Assumptions")),h.a.createElement(T.a,{className:"form-control",id:"level-assumptions",disabled:!this.name||this.props.rootStore.uiStore.disableCardActions,name:"assumptions",autoComplete:"off",value:this.assumptions||"",rows:3,onChange:this.onFormChange})),o,h.a.createElement(K,{level:this.props.level,levelProps:this.props.levelProps,submitFunc:this.updateSubmitType,cancelFunc:this.cancelEdit,nameVal:this.name,tierCount:this.props.rootStore.levelStore.chosenTierSet.length})))}}]),r}())||n)||n,K=Object(u.b)("rootStore")(i=function(){L(t,h.a.Component);var e=I(t);function t(){return k(this,t),e.apply(this,arguments)}return j(t,[{key:"render",value:function(){var e,t=!this.props.nameVal||this.props.rootStore.uiStore.disableCardActions,r=null;null!=this.props.level.parent&&"root"!=this.props.level.parent&&(e=interpolate(gettext("Save and add another %s"),[this.props.levelProps.tierName]),r=h.a.createElement(V,{disabled:t,classes:"btn-primary",icon:"plus-circle",text:e,submitType:"saveAndAddSibling",submitFunc:this.props.submitFunc}));var o,n=null,i=this.props.rootStore.levelStore.chosenTierSet.length;return this.props.level.level_depth<i&&(o=interpolate(gettext("Save and link %s"),[this.props.levelProps.childTierName]),n=h.a.createElement(V,{disabled:t,classes:"btn btn-primary",icon:"stream",text:o,submitType:"saveAndAddChild",submitFunc:this.props.submitFunc})),h.a.createElement("div",{className:"button-bar btn-row"},h.a.createElement(V,{disabled:t,classes:"btn-primary",text:gettext("Save and close"),icon:"save",submitType:"saveOnly",submitFunc:this.props.submitFunc}),r,n,h.a.createElement(V,{disabled:this.props.rootStore.uiStore.disableCardActions,classes:"btn btn-reset",text:gettext("Cancel"),submitType:"cancel",submitFunc:this.props.cancelFunc}))}}]),t}())||i,V=function(){L(t,h.a.Component);var e=I(t);function t(){return k(this,t),e.apply(this,arguments)}return j(t,[{key:"render",value:function(){var e=this,t="cancel"==this.props.submitType?"button":"submit";return h.a.createElement("button",{disabled:this.props.disabled,type:t,className:this.props.classes+" level-button btn btn-sm",onClick:function(){return e.props.submitFunc(e.props.submitType)}},this.props.text)}}]),t}(),M=Object(u.b)("rootStore")(a=function(){L(t,h.a.Component);var e=I(t);function t(){return k(this,t),e.apply(this,arguments)}return j(t,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0}),$('*[data-toggle="tooltip"]').tooltip()}},{key:"componentDidUpdate",value:function(){$('*[data-toggle="tooltip"]').tooltip()}},{key:"render",value:function(){var r=this,o=this.props.indicators.map(function(e,t){return{value:t+1,label:t+1}}),e=this.props.indicators.map(function(t){var e=h.a.createElement("span",{"data-toggle":"tooltip","data-delay":900,"data-template":'<div class="tooltip sortable-list__item__tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',title:t.name},h.a.createElement("span",null,t.name.replace(/(.{55})..+/,"$1...")));return h.a.createElement(h.a.Fragment,null,h.a.createElement(v.d,{update:function(e){return r.props.changeFunc(t.id,e)},selectId:"ind"+t.id,labelClasses:" ",formRowClasses:"sortable-list__item__label",selectClasses:"sortable-list__item__select",value:{value:t.level_order,label:t.level_order+1},label:e,options:o,disabled:r.props.disabled||r.props.reorderDisabled}),h.a.createElement("div",{className:"sortable-list__item__actions"},h.a.createElement(S.d,{readonly:r.props.disabled||r.props.rootStore.uiStore.disableCardActions,label:gettext("Settings"),indicatorId:t.id})))}),t=null,n=null,i=gettext("To link an already saved indicator to your results framework: Open the indicator from the program page and use the “Result level” menu on the Summary tab."),a=gettext("To remove an indicator: Click “Settings”, where you can reassign the indicator to a different level or delete it."),l=this.props.rootStore.levelStore.usingResultsFramework,s=l?a:i+"<br><br>"+a;return(0<this.props.indicators.length||!l)&&(t="Order",n=h.a.createElement(E.b,{content:s,placement:"bottom"})),h.a.createElement("div",{className:"level-card--indicator-links".concat(this.props.disabled?" disabled":"")},h.a.createElement("div",{className:"indicator-links__header"},h.a.createElement("h4",null,interpolate(gettext("Indicators linked to this %s"),[this.props.tierName])),h.a.createElement("div",null,n)),h.a.createElement("div",{className:"sortable-list-group"},0<this.props.indicators.length?h.a.createElement("div",{className:"sortable-list-header"},h.a.createElement("div",{className:"sortable-list-header__drag-handle"},h.a.createElement(g.a,{icon:f.a})),h.a.createElement("div",{className:"sortable-list-header__label"},t),h.a.createElement("div",{className:"sortable-list-header__actions"},h.a.createElement("i",{className:"fas fa-cog"})," ",gettext("Settings"))):null,h.a.createElement(H,{onSortEnd:this.props.dragEndFunc,useDragHandle:!0,lockAxis:"y",lockToContainerEdges:!0},e.map(function(e,t){return h.a.createElement(q,{key:"item-".concat(t),index:t,value:e,disabled:r.props.disabled||r.props.reorderDisabled})})),h.a.createElement("div",{className:"sortable-list-actions"},h.a.createElement(S.a,{readonly:!this.props.level.id||"new"==this.props.level.id||this.props.disabled||this.props.rootStore.uiStore.disableCardActions,programId:this.props.rootStore.levelStore.program_id,levelId:this.props.level.id}))))}}]),t}())||a,q=Object(_.b)(function(e){var t=e.value;return h.a.createElement("li",{className:"sortable-list__item"},h.a.createElement(U,null),t)}),H=Object(_.a)(function(e){var t=e.children;return h.a.createElement("ul",{className:"sortable-list"},t)}),U=Object(_.c)(function(){return h.a.createElement("div",{className:"sortable-list__item__drag-handle"},h.a.createElement(g.a,{icon:f.a}))});function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Q(e,t,r){return t&&G(e.prototype,t),r&&G(e,r),e}function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=ee(i);return t=a?(e=ee(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==W(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(r):o}}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}d.b.add(f.f,f.d),d.b.add(f.f,f.d);var te,re,oe=function(){Y(t,h.a.Component);var e=Z(t);function t(){return J(this,t),e.apply(this,arguments)}return Q(t,[{key:"render",value:function(){var e=y()("btn-delete btn btn-sm text-danger",this.props.buttonClasses),t=y()("fa fa-times",this.props.iconClasses);return h.a.createElement("button",{type:this.props.type||"button",onClick:this.props.action,onKeyUp:this.props.action,className:e},h.a.createElement("i",{className:t}))}}]),t}(),ne=function(){Y(t,h.a.Component);var e=Z(t);function t(){return J(this,t),e.apply(this,arguments)}return Q(t,[{key:"render",value:function(){return h.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:this.props.expandFunc,disabled:this.props.isDisabled},h.a.createElement(g.a,{icon:"plus-square"}),gettext("Expand all"))}}]),t}(),ie=function(){Y(t,h.a.Component);var e=Z(t);function t(){return J(this,t),e.apply(this,arguments)}return Q(t,[{key:"render",value:function(){return h.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:this.props.collapseFunc,disabled:this.props.isDisabled},h.a.createElement(g.a,{icon:"minus-square"}),gettext("Collapse all"))}}]),t}();function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ce(e,t,r){return t&&se(e.prototype,t),r&&se(e,r),e}function ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function de(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=fe(i);return t=a?(e=fe(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==ae(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(r):o}}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}d.b.add(f.b,f.c,f.g);var me,ve,he,be=Object(u.b)("rootStore")(te=Object(u.c)(te=function(){ue(i,h.a.Component);var e=de(i);function i(){return le(this,i),e.apply(this,arguments)}return ce(i,[{key:"render",value:function(){var n=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.sortedLevels.filter(function(e){return-1!=["root",null].indexOf(e.parent)}):this.props.renderList.sort(function(e,t){return e.customsort-t.customsort})).map(function(t){var e="",e=n.props.rootStore.uiStore.activeCard==t.id?h.a.createElement(z,{level:t,levelProps:n.props.rootStore.levelStore.levelProperties[t.id]}):h.a.createElement(B,{level:t,levelProps:n.props.rootStore.levelStore.levelProperties[t.id]}),r=n.props.rootStore.levelStore.sortedLevels.filter(function(e){return e.parent==t.id}),o=null;return 0<r.length&&(o=h.a.createElement(i,{rootStore:n.props.rootStore,renderList:r})),h.a.createElement("div",{key:t.id,className:"leveltier--new"},e,o)})}}]),i}())||te)||te,ge=Object(u.b)("rootStore")(re=Object(u.c)(re=function(){ue(i,h.a.Component);var n=de(i);function i(){var e;le(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=n.call.apply(n,[this].concat(r))).getWarningText=function(){return{__html:e.props.rootStore.uiStore.splashWarning}},e}return ce(i,[{key:"render",value:function(){var e=this,t=0===this.props.rootStore.uiStore.hasVisibleChildren.length||this.props.rootStore.uiStore.disableCardActions||this.props.rootStore.uiStore.activeCard,r=null;1<this.props.rootStore.levelStore.levels.filter(function(e){return"new"!==e.id}).length&&(r=h.a.createElement("div",{className:"level-list--expandos"},h.a.createElement("div",{className:"btn-group"},h.a.createElement(ne,{isDisabled:this.props.rootStore.uiStore.isExpandAllDisabled,expandFunc:this.props.rootStore.uiStore.expandAllLevels}),h.a.createElement(ie,{isDisabled:t,collapseFunc:this.props.rootStore.uiStore.collapseAllLevels})),h.a.createElement("div",{className:"level-list--action-buttons"},h.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:function(){window.open(e.props.rootStore.levelStore.excelURL,"_blank")}},h.a.createElement("i",{className:"fas fa-download"}),gettext("Excel")))));return 0==this.props.rootStore.levelStore.levels.length?h.a.createElement("div",{className:"level-list-panel"},h.a.createElement("div",{className:"level-list-panel__dingbat"},h.a.createElement(g.a,{icon:"sitemap"})),h.a.createElement("div",{className:"level-list-panel__text text-large",dangerouslySetInnerHTML:this.getWarningText()})):h.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},r,h.a.createElement(be,{renderList:"initial"}))}}]),i}())||re)||re;function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ee(e,t,r){return t&&_e(e.prototype,t),r&&_e(e,r),e}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=Oe(i);return t=a?(e=Oe(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==ye(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(r):o}}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe,ke=function(){Ce(t,h.a.Component);var e=we(t);function t(){return Se(this,t),e.apply(this,arguments)}return Ee(t,[{key:"render",value:function(){return h.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),t}(),Ne=Object(u.b)("rootStore")(me=Object(u.c)(me=function(){Ce(t,h.a.Component);var e=we(t);function t(){return Se(this,t),e.apply(this,arguments)}return Ee(t,[{key:"render",value:function(){var e=null;0===this.props.rootStore.levelStore.levels.length&&this.props.rootStore.levelStore.hasEditPermissions&&(e=h.a.createElement("div",{className:"leveltier-list__actions"},h.a.createElement("button",{className:"leveltier-button btn btn-primary btn-block",onClick:this.props.rootStore.levelStore.applyTierSet},gettext("Apply"))));var t=null;return this.props.rootStore.levelStore.chosenTierSetKey==this.props.rootStore.levelStore.customTierSetKey&&this.props.rootStore.levelStore.useStaticTierList&&this.props.rootStore.levelStore.hasEditPermissions&&(t=h.a.createElement("button",{className:"btn btn-link leveltier-list leveltier--editable__settings",onClick:this.props.rootStore.levelStore.editTierSet},h.a.createElement("i",{className:"fa fa-cog"}),gettext("Settings"))),h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},0<this.props.rootStore.levelStore.chosenTierSet.length?this.props.rootStore.levelStore.chosenTierSet.map(function(e,t){return h.a.createElement(ke,{key:t,tierLevel:t,tierName:e})}):null),t,e)}}]),t}())||me)||me,je=Object(u.b)("rootStore")(ve=function(){Ce(o,h.a.Component);var r=we(o);function o(e){var t;return Se(this,o),(t=r.call(this,e)).onBlur=function(e){e.relatedTarget&&e.relatedTarget.classList.contains("btn-delete")?t.props.rootStore.levelStore.deleteCustomTier(e):(t.props.rootStore.uiStore.validateCustomTiers(),e.relatedTarget&&"applyButton"==e.relatedTarget.id&&t.props.rootStore.levelStore.applyTierSet(),e.relatedTarget&&"addLevelButton"==e.relatedTarget.id&&t.props.rootStore.levelStore.addCustomTier())},t.inputRef=h.a.createRef(),t}return Ee(o,[{key:"componentDidMount",value:function(){this.inputRef.current.focus()}},{key:"render",value:function(){var e=null;this.props.showDeleteButton&&(e=h.a.createElement(oe,{buttonClasses:"p-0",type:"button",disabled:this.props.rootStore.uiStore.customFormErrors.hasErrors,action:this.props.rootStore.levelStore.deleteCustomTier}));var t=null;return this.props.showLockButton&&(t=h.a.createElement("a",{tabIndex:"0",className:"btn btn-sm btn-link","data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-content":gettext("This level is being used in the results framework")},h.a.createElement("i",{className:"fa fa-lock text-muted"}))),h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"form-group"},h.a.createElement("label",{className:"leveltier--editable__label"},interpolate(gettext("Level %s"),[this.props.tierOrder+1])),h.a.createElement("div",{className:"leveltier--editable"},h.a.createElement("input",{ref:this.inputRef,className:"leveltier--editable__input form-control",type:"text",maxLength:75,"data-tierorder":this.props.tierOrder,value:this.props.tierName,onChange:this.props.rootStore.levelStore.updateCustomTier,onBlur:this.onBlur}),e,t),h.a.createElement("span",{className:"has-error"},this.props.errorMsg)))}}]),o}())||ve,Le=Object(u.b)("rootStore")(he=Object(u.c)(he=function(){Ce(i,h.a.Component);var n=we(i);function i(){var e;Se(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=n.call.apply(n,[this].concat(r))).customTemplateFormSubmit=function(e){return e.preventDefault()},e}return Ee(i,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var a=this,e=this.props.rootStore.levelStore.customTierSetKey,t=this.props.rootStore.levelStore.chosenTierSet.map(function(e,t){var r=a.props.rootStore.uiStore.customFormErrors.errors.length>t?a.props.rootStore.uiStore.customFormErrors.errors[t]:null,o=r&&r.hasError?r.msg:null,n=!a.props.rootStore.levelStore.tierIsDeletable(t+1),i=!(t!==a.props.rootStore.levelStore.chosenTierSet.length-1||n||1===a.props.rootStore.levelStore.chosenTierSet.length&&0===e.length);return h.a.createElement(je,{key:t,tierName:e,showDeleteButton:i,showLockButton:n,tierOrder:t,errorMsg:o})})||null,r=!this.props.rootStore.levelStore.tierTemplates[e].tiers.every(function(e){return 0<e.length})||this.props.rootStore.uiStore.addLevelButtonIsLocked,o=t.length>=this.props.rootStore.levelStore.maxTiers?null:h.a.createElement("button",{id:"addLevelButton",type:"button",className:"btn btn-link btn-add",disabled:r,onClick:this.props.rootStore.levelStore.addCustomTier},h.a.createElement("i",{className:"fa fa-plus-circle"}),"Add level"),n=h.a.createElement("div",{className:"leveltier-list__actions"},h.a.createElement("button",{id:"applyButton",className:"leveltier-button btn btn-primary btn-block",disabled:r,type:"button",onClick:this.props.rootStore.levelStore.applyTierSet},gettext("Apply")));return h.a.createElement("form",{onSubmit:this.customTemplateFormSubmit},h.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},h.a.createElement("div",{className:""},t),o),n)}}]),i}())||he)||he;function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){if(null==e)return{};var r,o=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),i=0;i<n.length;i++)r=n[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r]);return o}function Ae(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,o,n=Re(i);return t=a?(e=Re(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),r=this,!(o=t)||"object"!==Pe(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(r):o}}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e){var t=e.programId,r="/tola_management/audit_log/".concat(t,"/");return h.a.createElement("div",{className:"leveltier-picker__change-log-link-box"},h.a.createElement("a",{href:r,className:"btn-link"},h.a.createElement("i",{className:"fas fa-history"})," ",gettext("Change log")))}var ze,Ke,$e,Ve,Me,qe,He,Ue,We,Je,Ge,Qe,Ye,Xe,Ze,et,tt,rt,ot,nt,it,at,lt,st,ct,ut,pt,dt,ft,mt,vt,ht,bt,gt,yt,St=Object(u.b)("rootStore")(xe=Object(u.c)(xe=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(i,h.a.Component);var e,t,r,n=Fe(i);function i(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(t=n.call.apply(n,[this].concat(r))).handleChange=function(e){t.props.rootStore.levelStore.changeTierSet(e.value)},t}return e=i,(t=[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e,t,r=null;"locked"==this.props.rootStore.uiStore.tierLockStatus?(e=this.props.rootStore.levelStore.chosenTierSet[0],t=this.props.rootStore.levelStore.chosenTierSet[1],r=h.a.createElement(E.b,{key:1,content:interpolate(gettext('<span class="text-danger"><strong>The results framework template is locked as soon as the first %(secondTier)s is saved.</strong></span> To change templates, all saved levels must be deleted except for the original %(firstTier)s. A level can only be deleted when it has no sub-levels and no linked indicators.'),{secondTier:t,firstTier:e},!0)})):"primed"==this.props.rootStore.uiStore.tierLockStatus&&(r=h.a.createElement(E.b,{key:2,content:this.props.rootStore.uiStore.splashWarning}));var o=this.props.rootStore.levelStore.tierTemplates,n=o.custom,i=Ie(o,["custom"]),a=Object.keys(i).sort().map(function(e){return{value:e,label:o[e].name}});a.push({label:"-----------------------------------------------------------",options:[{value:this.props.rootStore.levelStore.customTierSetKey,label:n.name}]});var l={value:this.props.rootStore.levelStore.chosenTierSetKey,label:this.props.rootStore.levelStore.chosenTierSetName},s="leveltier-picker__selectbox ";return s+="locked"==this.props.rootStore.uiStore.tierLockStatus?"leveltier-picker__selectbox--disabled":"",h.a.createElement("div",{className:s},h.a.createElement("div",{className:"form-group"},h.a.createElement("label",null,gettext("Results framework template"))," ",h.a.createElement("small",null,r),h.a.createElement(w.a,{maxMenuHeight:350,options:a,value:l,isDisabled:"locked"==this.props.rootStore.uiStore.tierLockStatus,isSearchable:!1,onChange:this.handleChange})))}}])&&Ae(e.prototype,t),r&&Ae(e,r),i}())||xe)||xe,_t=Object(u.b)("rootStore")(Object(u.c)(function(e){var t=h.a.createElement(Ne,null);return this.props.rootStore.levelStore.chosenTierSetKey==this.props.rootStore.levelStore.customTierSetKey&&!this.props.rootStore.levelStore.useStaticTierList&&this.props.rootStore.levelStore.hasEditPermissions&&(t=h.a.createElement(Le,null)),h.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},h.a.createElement("div",{className:"leveltier-picker__panel"},h.a.createElement(St,null),t),h.a.createElement(Be,{programId:e.rootStore.levelStore.program_id}))})),Et=r("XoI5");function Ct(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=wt(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}function Tt(e){return function(e){if(Array.isArray(e))return Ot(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||wt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){if(e){if("string"==typeof e)return Ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ot(e,t):void 0}}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function xt(e,t,r,o){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(o):void 0})}function kt(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Nt(e,t,r){return t&&kt(e.prototype,t),r&&kt(e,r),e}function jt(r,o,e,t,n){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,t){return t(r,o,e)||e},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(r,o,i),i=null),i}function Lt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Pt=(Ke=jt((ze=function(){function m(e,t,r,o,n,i,a,l,s,c,u,p){var d,f=this;Lt(this,m),xt(this,"levels",Ke,this),xt(this,"indicators",$e,this),xt(this,"chosenTierSetKey",Ve,this),xt(this,"useStaticTierList",Me,this),xt(this,"formErrors",qe,this),xt(this,"tierTemplates",He,this),this.program_id=void 0,this.tierTemplates=void 0,this.programObjectives=void 0,this.defaultTemplateKey="",this.customTierSetKey="",this.accessLevel=!1,this.usingResultsFramework=void 0,this.monitorHeaderLink=Object(b.e)(function(e){var t,r,o=$("#rf_builder_header"),n=0<o.children("a").length;0<f.indicators.length&&!n?(t=o.text(),o.html('<a href="/program/'.concat(f.program_id,'/">').concat(t,"</a>"))):0==f.indicators.length&&n&&(r=$("#rf_builder_header > a").text(),o.text(r))},{delay:50}),xt(this,"updateCustomTier",Ue,this),xt(this,"addCustomTier",We,this),xt(this,"deleteCustomTier",Je,this),xt(this,"applyTierSet",Ge,this),xt(this,"editTierSet",Qe,this),this.saveCustomTemplateToDB=function(){var e,t,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=r.addTier,n=r.isDeleting,i=r.shouldAlert;!n&&(f.rootStore.uiStore.validateCustomTiers(),f.rootStore.uiStore.customFormErrors.hasErrors)||(0===(e=Tt(f.tierTemplates[f.customTierSetKey].tiers))[0].length&&(e=null),t={program_id:f.program_id,tiers:e},Et.a.post("/save_custom_template/",t).then(function(e){i&&success_notice({message_text:gettext("Changes to the results framework template were saved."),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}}),o&&""!=f.chosenTierSet.slice(-1)&&f.chosenTierSet.push(""),f.rootStore.uiStore.setAddLevelButtonLockedStatus(!1)}).catch(function(e){f.rootStore.uiStore.setAddLevelButtonLockedStatus(!1)}))},xt(this,"cancelEdit",Ye,this),xt(this,"createNewLevelFromSibling",Xe,this),xt(this,"createNewLevelFromParent",Ze,this),xt(this,"createFirstLevel",et,this),this.saveLevelTiersToDB=function(){var e={program_id:f.program_id};return f.chosenTierSetKey===f.customTierSetKey?e.tiers=f.chosenTierSet:e.tiers=f.englishTierTemlates[f.chosenTierSetKey].tiers,Et.a.post("/save_leveltiers/",e)},this.deleteLevelFromDB=function(e){var t="".concat(f.levelProperties[e].tierName," ").concat(f.levelProperties[e].ontologyLabel);Et.a.delete("/level/".concat(e)).then(function(e){f.levels.replace(e.data),f.rootStore.uiStore.activeCard=null,0==f.levels.length&&f.createFirstLevel(),success_notice({message_text:interpolate(gettext("%s was deleted."),[t]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})}).catch(function(e){}),f.rootStore.uiStore.setDisableCardActions(!1)},this.saveLevelToDB=function(r,t,o,e){o&&f.saveReorderedIndicatorsToDB(e.indicators),delete e.indicators;var n=f.levels.find(function(e){return e.id==t}),i="".concat(f.levelProperties[t].tierName," ").concat(f.levelProperties[t].ontologyLabel),a=Object.assign(Object(b.r)(n),e),l=f.rootStore.uiStore.activeCardNeedsConfirm;"new"==t?("root"==a.parent&&$("#logframe_link").show(),delete a.id,delete a.rationale,Et.a.post("/insert_new_level/",a).then(function(e){Object(b.p)(function(){f.levels.replace(e.data.all_data)}),success_notice({message_text:interpolate(gettext("%s saved."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}});var t=e.data.new_level.id;f.rootStore.uiStore.activeCard=null,"saveAndEnableIndicators"==r?Object(b.p)(function(){f.rootStore.uiStore.activeCard=t}):"saveAndAddSibling"==r?f.createNewLevelFromSibling(t):"saveAndAddChild"==r&&f.createNewLevelFromParent(t)}).catch(function(e){})):Et.a.put("/level/".concat(t,"/"),a).then(function(e){(l||o)&&success_notice({message_text:interpolate(gettext("%s updated."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}}),Object(b.p)(function(){Object.assign(n,e.data)}),f.rootStore.uiStore.activeCard=null,"saveAndAddSibling"==r?f.createNewLevelFromSibling(t):"saveAndAddChild"==r&&f.createNewLevelFromParent(t)}).catch(function(e){}),f.fetchIndicatorsFromDB(),f.rootStore.uiStore.activeCardNeedsConfirm=!1},this.saveReorderedIndicatorsToDB=function(e){Et.a.post("/reorder_indicators/",e).then(function(e){f.fetchIndicatorsFromDB()}).catch(function(e){})},xt(this,"deleteIndicatorFromStore",tt,this),xt(this,"addIndicatorToStore",rt,this),xt(this,"moveIndicatorInStore",ot,this),this.fetchIndicatorsFromDB=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=e?"?indicatorId=".concat(e):"";Et.a.get("/indicator_list/".concat(f.program_id,"/").concat(t)).then(function(e){return Object(b.p)(function(){f.indicators=e.data})}).catch(function(e){})},this.deriveTemplateKey=function(e){var t=JSON.stringify(Object(b.r)(e));for(var r in f.englishTierTemlates){if(f.englishTierTemlates.hasOwnProperty(r)&&e.length==f.englishTierTemlates[r].tiers.length)if(t==JSON.stringify(f.englishTierTemlates[r].tiers))return r}return f.customTierSetKey},this.buildOntology=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=Object(b.r)(f.levels.find(function(e){return e.id==t}));return r.parent&&"root"!=r.parent?(e.unshift(r.customsort),f.buildOntology(r.parent,e)):e.join(".")},this.getChildLevels=function(t){return f.levels.filter(function(e){return e.parent==t})},this.getLevelIndicators=function(t){return f.indicators.filter(function(e){return e.level==t})},this.getDescendantIndicatorIds=function(t){var e=f.levels.filter(function(e){return t.includes(e.id)}),r=[];return e.forEach(function(t){r=r.concat(f.indicators.filter(function(e){return e.level==t.id}).map(function(e){return e.id}));var e=f.levels.filter(function(e){return e.parent==t.id}).map(function(e){return e.id});r=r.concat(f.getDescendantIndicatorIds(e,r))}),r},this.tierIsDeletable=function(e){var t,r=Ct(f.levels);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.level_depth===e&&0<o.name.length)return!1}}catch(e){r.e(e)}finally{r.f()}return!0},this.rootStore=p,this.levels=t,this.indicators=r,this.englishTierTemlates=JSON.parse(i),this.defaultTemplateKey="mc_standard",this.customTierSetKey="custom",this.program_id=e.id,this.manual_numbering=e.manual_numbering,this.programObjectives=l,this.accessLevel=s,this.usingResultsFramework=c,this.formErrors={hasError:!1},this.maxTiers=u,this.excelURL="/indicators/results_framework_export/".concat(e.id,"/"),this.tierTemplates=JSON.parse(n),this.tierTemplates[this.customTierSetKey]={name:gettext("Custom")},this.tierTemplates[this.customTierSetKey].tiers=a.names||[""],0<o.length?(d=o.map(function(e){return e.name}),this.chosenTierSetKey=this.deriveTemplateKey(d)):this.chosenTierSetKey=this.defaultTemplateKey,this.useStaticTierList=!(this.chosenTierSetKey===this.customTierSetKey&&0===this.levels.length)}return Nt(m,[{key:"changeTierSet",value:function(e){var t=this,r=this.chosenTierSet[0];this.chosenTierSetKey=e,this.chosenTierSetKey===this.customTierSetKey?(this.editTierSet(),this.tierTemplates[this.customTierSetKey].tiers[0]||1!==this.levels.filter(function(e){return"new"!==e.id}).length||(this.tierTemplates[this.customTierSetKey].tiers=[gettext(r)])):(this.rootStore.uiStore.customFormErrors={hasErrors:!1,errors:[]},this.rootStore.uiStore.setDisableCardActions(!1)),0<this.levels.length&&this.chosenTierSetKey!==this.customTierSetKey&&this.saveLevelTiersToDB().then(function(e){t.chosenTierSetKey!==t.customTierSetKey&&0<t.levels.filter(function(e){return"new"!==e.id}).length&&success_notice({message_text:gettext("Changes to the results framework template were saved."),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})}).catch(function(e){})}},{key:"updateIndicatorNameInStore",value:function(t,e){this.indicators.find(function(e){return e.id==t}).name=e}},{key:"sortedLevels",get:function(){return this.levels.slice().sort(function(e,t){e.level_depth-t.level_depth||(e.customsort,t.customsort)})}},{key:"chosenTierSet",get:function(){return this.tierTemplates[this.chosenTierSetKey].tiers}},{key:"levelProperties",get:function(){var n,i=this,a={},t=Ct(this.levels);try{for(t.s();!(n=t.n()).done;)!function(){var t=n.value,e={},r=i.getChildLevels(t.id).map(function(e){return e.id}),o=i.indicators.filter(function(e){return e.level==t.id});e.indicators=i.getLevelIndicators(t.id),e.descendantIndicatorIds=i.getDescendantIndicatorIds(r),e.ontologyLabel=i.buildOntology(t.id),e.tierName=i.chosenTierSet[t.level_depth-1],e.childTierName=null,i.chosenTierSet.length>t.level_depth&&(e.childTierName=i.chosenTierSet[t.level_depth]),e.canDelete=0==r.length&&0==o&&i.hasEditPermissions,e.canEdit=i.hasEditPermissions,a[t.id]=e}()}catch(e){t.e(e)}finally{t.f()}return a}},{key:"chosenTierSetName",get:function(){return this.tierTemplates[this.chosenTierSetKey].name}},{key:"hasEditPermissions",get:function(){return"high"===this.accessLevel}}]),m}()).prototype,"levels",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$e=jt(ze.prototype,"indicators",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ve=jt(ze.prototype,"chosenTierSetKey",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Me=jt(ze.prototype,"useStaticTierList",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qe=jt(ze.prototype,"formErrors",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),He=jt(ze.prototype,"tierTemplates",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jt(ze.prototype,"sortedLevels",[b.f],Object.getOwnPropertyDescriptor(ze.prototype,"sortedLevels"),ze.prototype),jt(ze.prototype,"chosenTierSet",[b.f],Object.getOwnPropertyDescriptor(ze.prototype,"chosenTierSet"),ze.prototype),jt(ze.prototype,"levelProperties",[b.f],Object.getOwnPropertyDescriptor(ze.prototype,"levelProperties"),ze.prototype),jt(ze.prototype,"chosenTierSetName",[b.f],Object.getOwnPropertyDescriptor(ze.prototype,"chosenTierSetName"),ze.prototype),jt(ze.prototype,"hasEditPermissions",[b.f],Object.getOwnPropertyDescriptor(ze.prototype,"hasEditPermissions"),ze.prototype),jt(ze.prototype,"changeTierSet",[b.d],Object.getOwnPropertyDescriptor(ze.prototype,"changeTierSet"),ze.prototype),Ue=jt(ze.prototype,"updateCustomTier",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.tierTemplates[t.customTierSetKey].tiers[e.target.dataset.tierorder]=e.target.value}}}),We=jt(ze.prototype,"addCustomTier",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.rootStore.uiStore.setAddLevelButtonLockedStatus(!0),e.saveCustomTemplateToDB({addTier:!0})}}}),Je=jt(ze.prototype,"deleteCustomTier",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){if(0===e.detail&&!e.key||e.key&&"Enter"!=e.key)return!1;1===t.chosenTierSet.length?(t.tierTemplates[t.customTierSetKey].tiers=[""],t.rootStore.uiStore.clearValidationMessages()):(t.tierTemplates[t.customTierSetKey].tiers.pop(),t.rootStore.uiStore.validateCustomTiers()),t.saveCustomTemplateToDB({isDeleting:!0})}}}),Ge=jt(ze.prototype,"applyTierSet",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(e&&e.preventDefault(),t.chosenTierSetKey===t.customTierSetKey&&t.rootStore.uiStore.customFormErrors.hasErrors)return!1;if(t.saveLevelTiersToDB(),t.chosenTierSetKey===t.customTierSetKey){if(t.rootStore.uiStore.validateCustomTiers(),t.rootStore.uiStore.customFormErrors.hasErrors)return;t.saveCustomTemplateToDB({shouldAlert:!0}),t.useStaticTierList=!0}0===t.levels.length&&t.createFirstLevel(),t.rootStore.uiStore.setDisableCardActions(!1)}}}),Qe=jt(ze.prototype,"editTierSet",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.useStaticTierList=!1,e.rootStore.uiStore.setDisableCardActions(!0)}}}),Ye=jt(ze.prototype,"cancelEdit",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var r;"new"==t&&(r=e.levels.find(function(e){return e.id==t}),e.levels.filter(function(e){return e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return--e.customsort}),e.levels.replace(e.levels.filter(function(e){return"new"!=e.id}))),e.fetchIndicatorsFromDB(),e.rootStore.uiStore.removeActiveCard()}}}),Xe=jt(ze.prototype,"createNewLevelFromSibling",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t){var r=Object(b.r)(o.levels.find(function(e){return e.id==t})),e=Object.assign({},r);e.customsort+=1,e.id="new",e.name="",e.assumptions="",o.levels.filter(function(e){return r&&e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort+=1}),o.rootStore.uiStore.activeCard="new",o.levels.push(e),setTimeout(function(){$("#level-card-new")[0].scrollIntoView({behavior:"smooth"})},100)}}}),Ze=jt(ze.prototype,"createNewLevelFromParent",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t){var e=Object(b.r)(o.levels.find(function(e){return e.id==t})),r={id:"new",customsort:1,name:"",assumptions:"",parent:t,level_depth:e.level_depth+1,program:o.program_id};o.levels.filter(function(e){return e.parent==t}).forEach(function(e){return e.customsort+=1}),o.levels.push(r),o.rootStore.uiStore.activeCard="new",o.rootStore.uiStore.hasVisibleChildren.push(r.parent)}}}),et=jt(ze.prototype,"createFirstLevel",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e={id:"new",program:t.program_id,name:"",assumptions:"",customsort:1,level_depth:1,parent:"root"};t.levels.push(e),t.rootStore.uiStore.activeCard="new"}}}),jt(ze.prototype,"updateIndicatorNameInStore",[b.d],Object.getOwnPropertyDescriptor(ze.prototype,"updateIndicatorNameInStore"),ze.prototype),tt=jt(ze.prototype,"deleteIndicatorFromStore",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){e.indicators=e.indicators.filter(function(e){return e.id!=t}),e.indicators.filter(function(e){return e.level==r}).sort(function(e,t){return e.level_order-t.level_order}).forEach(function(e,t){return e.level_order=t})}}}),rt=jt(ze.prototype,"addIndicatorToStore",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.indicators.push(e)}}}),ot=jt(ze.prototype,"moveIndicatorInStore",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t,r){var e=o.indicators.find(function(e){return e.id==t});e.level=r,e.level_order=o.indicators.filter(function(e){return e.level==r}).length-1}}}),ze),It=(it=jt((nt=function(){function t(e){Lt(this,t),xt(this,"activeCard",it,this),xt(this,"hasVisibleChildren",at,this),xt(this,"disableCardActions",lt,this),xt(this,"customFormErrors",st,this),xt(this,"addLevelButtonIsLocked",ct,this),this.activeCardNeedsConfirm="",xt(this,"editCard",ut,this),xt(this,"onLeaveConfirm",pt,this),xt(this,"setDisableCardActions",dt,this),xt(this,"removeActiveCard",ft,this),xt(this,"updateVisibleChildren",mt,this),xt(this,"expandAllLevels",vt,this),xt(this,"collapseAllLevels",ht,this),xt(this,"setAddLevelButtonLockedStatus",bt,this),xt(this,"validateCustomTiers",gt,this),xt(this,"clearValidationMessages",yt,this),this.rootStore=e,this.hasVisibleChildren=this.rootStore.levelStore.levels.map(function(e){return e.id}),this.activeCardNeedsConfirm=!1,this.activeCard=null,this.disableCardActions=!1,this.customFormErrors={hasErrors:!1,errors:[]},this.addLevelButtonIsLocked=!1,this.splashWarning=gettext('<strong class="text-danger">Choose your results framework template carefully!</strong> Once you begin building your framework, it will not be possible to change templates without first deleting saved levels.')}return Nt(t,[{key:"tierLockStatus",get:function(){return!this.rootStore.levelStore.hasEditPermissions||1<this.rootStore.levelStore.levels.length?"locked":0<this.rootStore.levelStore.levels.length?"primed":null}},{key:"isExpandAllDisabled",get:function(){if(0==this.rootStore.levelStore.levels.length||this.disableCardActions||this.activeCard)return!0;var e,t=new Set(this.rootStore.levelStore.levels.map(function(e){return e.parent})),t=Array.from(t).filter(function(e){return null!=e}),r=new Set(Tt(this.hasVisibleChildren)),o=Ct(t);try{for(o.s();!(e=o.n()).done;){var n=e.value;if(!r.has(n))return!1}}catch(e){o.e(e)}finally{o.f()}return!0}},{key:"disabledActionsOrActiveCard",get:function(){return this.disableCardActions||this.activeCard}}]),t}()).prototype,"activeCard",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at=jt(nt.prototype,"hasVisibleChildren",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lt=jt(nt.prototype,"disableCardActions",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=jt(nt.prototype,"customFormErrors",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=jt(nt.prototype,"addLevelButtonIsLocked",[b.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt(nt.prototype,"tierLockStatus",[b.f],Object.getOwnPropertyDescriptor(nt.prototype,"tierLockStatus"),nt.prototype),jt(nt.prototype,"isExpandAllDisabled",[b.f],Object.getOwnPropertyDescriptor(nt.prototype,"isExpandAllDisabled"),nt.prototype),jt(nt.prototype,"disabledActionsOrActiveCard",[b.f],Object.getOwnPropertyDescriptor(nt.prototype,"disabledActionsOrActiveCard"),nt.prototype),ut=jt(nt.prototype,"editCard",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(e){var t,r=o.activeCard;o.activeCardNeedsConfirm?(o.setDisableCardActions(!0),$("#level-card-".concat(o.activeCard))[0].scrollIntoView({behavior:"smooth"}),t=o.rootStore.levelStore.levelProperties[o.activeCard].tierName,Object(O.a)({header:gettext("Warning"),show_icon:!0,message_text:gettext("Are you sure you want to continue?"),preamble:interpolate(gettext("Changes to this %s will not be saved"),[t]),notice_type:"notice",include_rationale:!1,rationale_required:!1,on_submit:function(){return o.onLeaveConfirm(e,r)},on_cancel:function(){return o.setDisableCardActions(!1)}})):(o.activeCard=e,o.rootStore.levelStore.levels.replace(o.rootStore.levelStore.levels.filter(function(e){return"new"!=e.id})))}}}),pt=jt(nt.prototype,"onLeaveConfirm",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(e,t){r.setDisableCardActions(!1),r.rootStore.levelStore.cancelEdit(t),r.activeCardNeedsConfirm=!1,r.activeCard=e,setTimeout(function(){$("#level-card-".concat(e))[0].scrollIntoView({behavior:"smooth"})},100)}}}),dt=jt(nt.prototype,"setDisableCardActions",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.disableCardActions=e}}}),ft=jt(nt.prototype,"removeActiveCard",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.activeCard=null,e.rootStore.uiStore.activeCardNeedsConfirm=!1}}}),mt=jt(nt.prototype,"updateVisibleChildren",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];0<=r.hasVisibleChildren.indexOf(t)||e?(r.hasVisibleChildren=r.hasVisibleChildren.filter(function(e){return e!=t}),r.rootStore.levelStore.levels.filter(function(e){return e.parent==t}).forEach(function(e){return r.updateVisibleChildren(e.id,!0)})):r.hasVisibleChildren.push(t)}}}),vt=jt(nt.prototype,"expandAllLevels",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.hasVisibleChildren=e.rootStore.levelStore.levels.map(function(e){return e.id})}}}),ht=jt(nt.prototype,"collapseAllLevels",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){return e.hasVisibleChildren=[]}}}),bt=jt(nt.prototype,"setAddLevelButtonLockedStatus",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){return t.addLevelButtonIsLocked=e}}}),gt=jt(nt.prototype,"validateCustomTiers",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(){var n=!1,e=r.rootStore.levelStore.customTierSetKey,i=r.rootStore.levelStore.tierTemplates[e].tiers;r.setAddLevelButtonLockedStatus(!1);var t=i.map(function(t){var e=0===t.length||/^\s*$/.test(t)&&0<t.length,r=0,o=-1!==t.indexOf(",");return i.forEach(function(e){e==t&&(r+=1)}),e?{hasError:n=!0,msg:gettext("Please complete this field.")}:o?{hasError:n=!0,msg:gettext("Result levels should not contain commas.")}:1<r?{hasError:n=!0,msg:gettext("Result levels must have unique names.")}:{hasError:!1,msg:""}});r.customFormErrors={hasErrors:n,errors:t}}}}),yt=jt(nt.prototype,"clearValidationMessages",[b.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.customFormErrors={hasErrors:!1,errors:[]}}}}),nt),At=jsContext,Dt=new function e(t,r,o,n,i,a,l,s,c,u,p){Lt(this,e),this.levelStore=new Pt(t,r,o,n,i,a,l,s,c,u,p,this),this.uiStore=new It(this)}(At.program,At.levels,At.indicators,At.levelTiers,At.tierTemplates,At.englishTemplates,At.customTemplates,At.programObjectives,At.accessLevel,At.usingResultsFramework,At.maxTiers);c.a.render(h.a.createElement(u.a,{rootStore:Dt},h.a.createElement(h.a.Fragment,null,h.a.createElement(_t,null),h.a.createElement(ge,null))),document.querySelector("#level-builder-react-component")),Object(p.c)()},"WtQ/":function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"a",function(){return n}),r.d(t,"b",function(){return i}),r.d(t,"d",function(){return a});function o(){$(function(){var e=0===window.performance.getEntriesByType("navigation")[0].transferSize,t="reload"===window.performance.getEntriesByType("navigation")[0].type;e&&!t&&window.location.reload()})}var n=function(e){if(null==e||isNaN(parseFloat(e)))return null;var t,r=e.toString(),o=null;switch(e.toString().includes(",")?(r=e.toString().split(",")[0],o=1<e.toString().split(",").length?e.toString().split(",")[1]:null):e.toString().includes(".")&&(r=e.toString().split(".")[0],o=1<e.toString().split(".").length?e.toString().split(".")[1]:null),o=o&&0<o.length?o:null,window.userLang){case"es":t=r.replace(/\B(?=(\d{3})+(?!\d))/g,"."),o&&(t+=",".concat(o));break;case"fr":t=r.replace(/\B(?=(\d{3})+(?!\d))/g,String.fromCharCode(160)),o&&(t+=",".concat(o));break;case"en":default:t=r.replace(/\B(?=(\d{3})+(?!\d))/g,","),o&&(t+=".".concat(o))}return t},i=function(e){if(null==e||isNaN(parseFloat(e)))return null;var t=n(Math.round(1e4*e)/100);return null===t?null:"".concat(t,"%")},a=function(e,t){var r=1<arguments.length&&void 0!==t?t:"label";return e.sort(function(e,t){return e[r].toUpperCase()>t[r].toUpperCase()?1:-1})}},XoI5:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var o=r("vDqi"),n=r.n(o).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},hzyr:function(e,t,r){"use strict";r.d(t,"a",function(){return l}),r.d(t,"d",function(){return s}),r.d(t,"c",function(){return c}),r.d(t,"b",function(){return u});var o=r("q1tI"),i=r.n(o),n=r("okNM");function a(e,t){if(null==e)return{};var r,o=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),i=0;i<n.length;i++)r=n[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r]);return o}var l=Object(n.c)(function(e){var t=e.readonly,r=a(e,["readonly"]);return i.a.createElement("button",{type:"button",disabled:t,className:"btn btn-sm btn-link px-0 btn-add text-nowrap",onClick:function(){openCreateIndicatorFormModal(r)}},i.a.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Add indicator"))}),s=Object(n.c)(function(e){var t=e.readonly,r=e.label,o=void 0===r?null:r,n=a(e,["readonly","label"]);return i.a.createElement("button",{type:"button",disabled:t,className:"btn btn-link",onClick:function(){openUpdateIndicatorFormModal(n)}},i.a.createElement("i",{className:"fas fa-cog"}),o)}),c=Object(n.c)(function(e){var t=e.clickHandler,r=e.disabled;return i.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:t,disabled:r},i.a.createElement("i",{className:"fas fa-plus-square"}),gettext("Expand all"))}),u=Object(n.c)(function(e){var t=e.clickHandler,r=e.disabled;return i.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:t,disabled:r},i.a.createElement("i",{className:"fas fa-minus-square"}),gettext("Collapse all"))})},qtBC:function(e,t,r){"use strict";var o=r("7+Rn"),n=r.n(o)()();t.a=n},v38i:function(e,t,r){"use strict";var o;r.d(t,"a",function(){return n}),r.d(t,"b",function(){return a}),r.d(t,"c",function(){return i}),r.d(t,"l",function(){return l}),r.d(t,"i",function(){return s}),r.d(t,"k",function(){return c}),r.d(t,"f",function(){return u}),r.d(t,"m",function(){return p}),r.d(t,"j",function(){return d}),r.d(t,"d",function(){return f}),r.d(t,"e",function(){return m}),r.d(t,"g",function(){return h}),r.d(t,"h",function(){return b});var n={value:null,label:"---------"},i="—",a=i,l=1,s=2,c=[3,4,5,6,7],u=[1,2],p=Object.freeze({1:gettext("Life of Program (LoP) only"),2:gettext("Midline and endline"),3:gettext("Annual"),4:gettext("Semi-annual"),5:gettext("Tri-annual"),6:gettext("Quarterly"),7:gettext("Monthly")}),d=Object.freeze({3:gettext("Years"),4:gettext("Semi-annual periods"),5:gettext("Tri-annual periods"),6:gettext("Quarters"),7:gettext("Months")}),f=1,m=2;var v,h=Object.freeze({noFilter:0,missingTarget:1,missingResults:2,missingEvidence:3,aboveTarget:5,belowTarget:6,onTarget:7,nonReporting:8}),b=null!==(v="reason_for_change_options",o="undefined"!=typeof JS_GLOBALS&&JS_GLOBALS.hasOwnProperty(v)?JS_GLOBALS[v]:null)&&void 0!==o?o:[]}},[["QTZG",0,1]]]);