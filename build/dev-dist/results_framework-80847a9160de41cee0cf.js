(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"4L+s":function(e,t,r){"use strict";r.d(t,"b",(function(){return v})),r.d(t,"a",(function(){return h}));var o=r("q1tI"),n=r.n(o),i=r("i8i4"),a=r.n(i);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=m(e);if(t){var n=m(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return f(this,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){u(a,e);var t,r,o,i=d(a);function a(e){var t;return s(this,a),(t=i.call(this,e)).placement=e.placement||null,t.popoverRef=e.innerRef||n.a.createRef(),t.iconClass=e.iconClass||"far fa-question-circle",t.iconStyle=e.iconStyle||{},t.linkStyle={},e.linkHeight&&(t.linkStyle.height=e.linkHeight),t}return t=a,(r=[{key:"render",value:function(){return n.a.createElement("a",{tabIndex:"0",style:this.linkStyle,"data-toggle":"popover","data-trigger":"focus","data-html":"true","data-placement":this.placement,"data-content":this.props.content,className:this.props.className,ref:this.popoverRef},n.a.createElement("i",{"aria-label":this.props.ariaText,style:this.iconStyle,className:this.iconClass}))}}])&&c(t.prototype,r),o&&c(t,o),a}(n.a.Component),h=function(e){u(r,e);var t=d(r);function r(){var e;s(this,r);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).popoverName="base",e.componentDidMount=function(){e.bodyClickHandler=function(t){0==$("#".concat(e.popoverName,"_popover_content")).parent().find($(t.target)).length&&$(e.refs.target).popover("hide")};var t=function(){$("body").on("click",e.bodyClickHandler),$(e.refs.target).popover("update").on("hide.bs.popover",(function(){$("body").off("click",e.bodyClickHandler)}))};$(e.refs.target).popover({content:'<div id="'.concat(e.popoverName,'_popover_content"></div>'),html:!0,placement:"bottom"}).on("shown.bs.popover",(function(r){a.a.render(e.getPopoverContent(),document.querySelector("#".concat(e.popoverName,"_popover_content")),t)}))},e.getPopoverContent=function(){throw new Error("not implemented")},e}return r}(n.a.Component)},"4a4Y":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var o=r("v38i"),n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.custom_rfc_options,r=void 0===t?null:t,n=r||o.h;if(!n)return"";var i=document.createElement("section");i.classList.add("pnotify__reason-for-change");var a=document.createElement("div");a.classList.add("form-group");var l=document.createElement("label");l.appendChild(document.createTextNode(gettext("Reason for change"))),l.htmlFor="reasons_for_change_select",a.appendChild(l);var s=document.createElement("select");s.name="reasons_for_change",s.id="reasons_for_change_select",s.setAttribute("multiple",""),s.classList.add("form-control");for(var c=0;c<n.length;c++){var u=document.createElement("option");if(u.value=n[c].value,u.label=n[c].label,u.text=n[c].label,c==n.length-1){var p=document.createElement("option");p.setAttribute("data-role","divider"),s.appendChild(p)}s.appendChild(u)}return a.appendChild(s),i.appendChild(a),i},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.header,r=void 0===t?null:t,o=e.show_icon,i=void 0===o||o,a=e.message_text,l=void 0===a?null:a,s=e.preamble,c=void 0===s?null:s,u=e.on_submit,p=void 0===u?function(){}:u,d=e.on_cancel,f=void 0===d?function(){}:d,m=e.rfc_required,v=void 0===m||m,h=e.rfc_options,b=void 0===h?null:h,g=e.rationale_required,y=void 0===g||g,S=e.include_rationale,_=void 0!==S&&S,E=e.validation_type,C=void 0===E?0:E,T=e.showCloser,w=void 0===T||T,O=e.confirm_text,x=void 0===O?gettext("Ok"):O,k=e.cancel_text,N=void 0===k?gettext("Cancel"):k,j=e.context,L=void 0===j?null:j,P=e.notice_type,I=void 0===P?"notice":P,A=(e.blocking,e.self_dismissing),D=void 0!==A&&A,F=e.dismiss_delay,R=void 0===F?8e3:F,B={error:"fa-exclamation-triangle",info:"fa-info-circle",success:"fa-check-circle",notice:"fa-exclamation-triangle"},z={error:"danger",info:"info",success:"success",notice:"primary"},K="";i&&(K='<i class="fas '.concat(B[I],'"></i>'));var V=r||K?'<header class="pnotify__header">\n            <h4>\n                '.concat(K,"\n                ").concat(r||"","\n            </h4>\n        </header>"):"",M=c?'<section class="pnotify__preamble">\n            <p><b>'.concat(c,"</b></p>\n        </section>"):"",q=l?'<section class="pnotify__message">\n            <p>'.concat(l,"</p>\n        </section>"):"",H="";if(null!==b){var U=!0===b?null:b;H=n({custom_rfc_options:U}).outerHTML}var W=H.length>0?"<label>".concat(gettext("Details"),"</label>"):"",J=_?'<section class="pnotify__rationale">\n            <div class="form-group">\n                '.concat(W,'\n                <textarea class="form-control" name="rationale" />\n            </div>\n        </section>'):"",G="\n        ".concat(V,"\n        ").concat(M,"\n        ").concat(q,"\n        ").concat(H,"\n        ").concat(J,"\n    "),Q={text:x,primary:!0,addClass:"btn-sm btn-"+z[I],click:function(e){var t=!0,r=$(e.refs.elem).find('textarea[name="rationale"]');r.parent().find(".invalid-feedback").remove();var o=r.val()?r.val().trim():void 0,n=($(e.refs.elem).find('select[name="reasons_for_change"]').val()||[]).map((function(e){return parseInt(e)})),i=!1;switch(C){case 1:i=o||n.length>0&&-1==n.indexOf(1);break;case 0:default:i=(o||!_||!y)&&(n.length>0||!b||!v)}if(!i)return r.addClass("is-invalid"),r.parent().append('<div class="invalid-feedback">'+gettext("A reason is required.")+"</div>"),!1;r.removeClass("is-invalid"),p&&void 0===(t=p(o,n,C))&&(t=!0),t&&(document.getElementById("notification_blocking_div").style.display="none",e.close())}},Y={text:N,addClass:"btn-sm",click:function(e){close=f(),void 0===close&&(close=!0),close&&(document.getElementById("notification_blocking_div").style.display="none",e.close())}},X=[];x&&X.push(Q),N&&X.push(Y);var Z=PNotify.alert({text:$('<div><form action="" method="post" class="form">'.concat(G,"</form></div>")).html(),textTrusted:!0,icon:!1,width:"350px",hide:D,delay:R,type:I,addClass:"program-page__rationale-form",stack:{overlayClose:!0,dir1:"right",dir2:"up",firstpos1:20,firstpos2:20,context:L},modules:{Buttons:{closer:w,closerHover:!1,sticker:!1},Confirm:{align:"flex-start",confirm:!0,buttons:X}}});$(".pnotify__reason-for-change select").multiselect({numberDisplayed:1,nSelectedText:" ".concat(gettext("selected")),nonSelectedText:gettext("None selected")}),f&&Z.on("click",(function(e){if($(e.target).is(".ui-pnotify-closer *")){var t=f();(t||void 0===t)&&(document.getElementById("notification_blocking_div").style.display="none",Z.close())}}))}},Ez0T:function(e,t,r){"use strict";r.d(t,"d",(function(){return h})),r.d(t,"a",(function(){return b})),r.d(t,"c",(function(){return S})),r.d(t,"b",(function(){return _}));var o=r("q1tI"),n=r.n(o),i=r("Cs6D"),a=r("VCnP"),l=r.n(a),s=0;function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";return s++,"".concat(e).concat(s)}var u=r("v38i");function p(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=function(e){var t=c("react-select"),r=e.labelClasses||"col-form-label text-uppercase",o=e.formRowClasses||"form-row mb-3",a=e.selectClasses||"tola-react-select";return n.a.createElement("div",{className:o},n.a.createElement("label",{htmlFor:t,className:r},e.label),n.a.createElement(i.a,{onChange:e.update,value:e.value,id:t,className:a,isDisabled:e.disabled,options:e.options}))},b=function(e){var t=c("date-select"),r=e.options&&1==e.options.length&&void 0!==e.options[0].value?n.a.createElement("option",{value:e.options[0].value},e.options[0].label):e.options&&e.options.length>0&&e.options[0].options&&void 0!==e.options[0].options?e.options.map((function(e,t){return n.a.createElement("optgroup",{label:e.label,key:t},e.options.map((function(e){return n.a.createElement("option",{value:e.value,key:e.value},e.label)})))})):e.options.map((function(e,t){return n.a.createElement("option",{value:e.value,key:t},e.label)}));return n.a.createElement("div",{className:"form-row mb-3"},n.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),n.a.createElement("select",{className:"form-control",id:t,value:e.value,onChange:e.update,disabled:e.disabled},r))},g=function(e){var t=c("react-select"),r=e.formGroupClass||"form-row mb-3",o=e.labelClass||"col-form-label text-uppercase",i=e.selectClass||"form-control";return n.a.createElement("div",{className:r},n.a.createElement("label",{htmlFor:t,className:o},e.label),n.a.createElement("select",{onChange:e.update,value:e.value,id:t,className:i,disabled:e.disabled},e.options))},y=function(e){return""==e.children?n.a.createElement("div",null):n.a.createElement(n.a.Fragment,null,n.a.createElement("hr",{style:{margin:"3px 0px 0px 0px"}}),n.a.createElement("div",{className:"text-muted",style:{textTransform:"uppercase",paddingLeft:"4px",marginBottom:"2px"}},e.children))},S=function(e){var t=c("multiselect"),r=!e.options||0==e.options.length||1==e.options.length&&null===e.options[0].value,o=r?{getDropdownButtonLabel:function(){return gettext("None available")},isDisabled:!0,menuIsOpen:!1,options:[]}:{isMulti:!0,options:e.options,getDropdownButtonLabel:function(e){if(!e.value)return gettext("None selected");if(Array.isArray(e.value)){var t=e.value.filter((function(e){return!e.noList}));return 0==t.length?gettext("None selected"):1==t.length?t[0].label:"".concat(t.length,"  ").concat(gettext("selected"))}return e.value.label}},i={dropdownButton:function(e){return r?m(m({},e),{},{backgroundColor:"#E5E6E8",background:""}):e},option:function(e,t){return m(m({},e),{},{padding:"1px 12px",display:"inline-block"})},container:function(e,t){return m(m({},e),{},{backgroundColor:"#f5f5f5"})}};return n.a.createElement("div",{className:"form-row mb-2 tola-react-multiselect-row"},n.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),n.a.createElement(l.a,d({id:t,styles:i,formatOptionLabel:function(e){return n.a.createElement("div",{style:{display:"inline-block",float:"right",width:"90%"}},e.label)},components:{GroupHeading:y},value:e.value,onChange:e.update},o)))},_=function(e){var t=e.chainLabel,r=p(e,["chainLabel"]),o=[n.a.createElement("option",{value:u.d,key:1},t),n.a.createElement("option",{value:u.e,key:2},gettext("by Level"))];return n.a.createElement(g,d({label:gettext("Group indicators"),options:o},r))}},QTZG:function(e,t,r){"use strict";r.r(t);var o,n,i,a,l=r("q1tI"),s=r.n(l),c=r("i8i4"),u=r.n(c),p=r("okNM"),d=(r("qtBC"),r("WtQ/")),f=r("2vnA"),m=r("7O5W"),v=r("wHSu"),h=r("IP2g"),b=r("TSYQ"),g=r.n(b),y=r("Ez0T"),S=r("hzyr"),_=r("YJCA"),E=r("4L+s"),C=r("O6Fj"),T=r.n(C),w=r("Cs6D"),O=r("4a4Y");function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t,r){return t&&N(e.prototype,t),r&&N(e,r),e}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=F(e);if(t){var n=F(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return A(this,r)}}function A(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?D(e):t}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}m.b.add(v.b,v.c,v.a);var R=function(e){L(r,e);var t=I(r);function r(){return k(this,r),t.apply(this,arguments)}return j(r,[{key:"render",value:function(){return s.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),r}(s.a.Component),B=function(e){L(r,e);var t=I(r);function r(){var e;k(this,r);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).onChange=function(t){e.props.onProgramObjectiveImport(t.value)},e}return j(r,[{key:"render",value:function(){var e=this.props.programObjectives;if(0===e.length)return null;var t=e.map((function(e){return{value:e.id,label:e.name}}));return s.a.createElement("div",{className:"program-objective-import mb-3"},s.a.createElement(w.a,{placeholder:gettext("Import Program Objective"),onChange:this.onChange,value:"",className:"tola-react-select",options:t,isDisabled:this.props.isDisabled}),s.a.createElement("a",{href:"#",className:"program-objective-import__icon",tabIndex:"0","data-html":"true","data-toggle":"popover","data-placement":"bottom","data-trigger":"focus","data-content":gettext("Import text from a Program Objective. <strong class='program-objective-import__popover-strong-text'>Make sure to remove levels and numbers from your text, because they are automatically displayed.</strong>"),onClick:function(e){return e.preventDefault()}},s.a.createElement("i",{className:"far fa-question-circle"})))}}]),r}(s.a.Component),z=Object(p.b)("rootStore")(o=Object(p.c)(o=function(e){L(r,e);var t=I(r);function r(){var e;k(this,r);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).deleteLevel=function(){e.props.rootStore.uiStore.setDisableCardActions(!0);var t=e.props.levelProps.tierName+" "+e.props.levelProps.ontologyLabel;Object(O.a)({header:gettext("Warning"),show_icon:!0,notice_type:"error",preamble:gettext("This action cannot be undone."),message_text:interpolate(gettext("Are you sure you want to delete %s?"),[t]),on_submit:function(){return e.props.rootStore.levelStore.deleteLevelFromDB(e.props.level.id)},on_cancel:function(){return e.props.rootStore.uiStore.setDisableCardActions(!1)}})},e.editLevel=function(){e.props.rootStore.uiStore.editCard(e.props.level.id)},e.buildIPTTUrl=function(t){var r="/indicators/iptt_report/".concat(e.props.rootStore.levelStore.program_id,"/timeperiods/?frequency=3&start=0&end=999");return t.forEach((function(e){return r+="&indicators="+e})),r},e}return j(r,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidUpdate",value:function(e,t,r){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e=this;if(this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.parent)<0&&null!=this.props.level.parent)return null;var t=[],r=this.props.levelProps.indicators.map((function(e){return e.id}));if(r.length>0){var o=gettext("All indicators linked to %s"),n=interpolate(o,["".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel)]);t.push('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(r),">").concat(n,"</a></li>"))}if(this.props.levelProps.tierName!=this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0]){var i=this.props.levelProps.descendantIndicatorIds;if(i.length>0){i=i.concat(r);var a=gettext("All indicators linked to %s and sub-levels"),l=interpolate(a,["".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel)]);t.unshift('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(i),">").concat(l,"</a></li>"))}}var c=this.props.levelProps.indicators.sort((function(e,t){return e.level_order-t.level_order})).map((function(t,r){var o="";return e.props.rootStore.levelStore.manual_numbering?e.props.rootStore.levelStore.manual_numbering&&t.number&&(o=t.number+": "):o=e.props.levelProps.ontologyLabel+String.fromCharCode(97+r)+": ",'<li class="nav-item level-card--iptt-links"><a href='.concat(e.buildIPTTUrl([t.id]),">").concat(o).concat(t.name,"</a></li>")}));t=t.concat(c);var u='<ul class="nav flex-column">'.concat(t.join(""),"</ul>"),p=this.props.levelProps.indicators.length,d=interpolate(ngettext("%s indicator","%s indicators",p),[p]),m=null;this.props.levelProps.tierName!=Object(f.r)(this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0])&&this.props.rootStore.levelStore.levels.filter((function(t){return t.parent==e.props.level.id})).length>0&&(m=s.a.createElement(h.a,{className:this.props.rootStore.uiStore.disabledActionsOrActiveCard?"":"text-action",icon:this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.id)>=0?"caret-down":"caret-right"}));var v=m&&!this.props.rootStore.uiStore.disabledActionsOrActiveCard?"level-card__toggle":null,b=this.props.rootStore.uiStore.disabledActionsOrActiveCard?null:function(t){return e.props.rootStore.uiStore.updateVisibleChildren(e.props.level.id)},y=0===t.length||this.props.rootStore.uiStore.disableCardActions;return s.a.createElement("div",{className:"level-card level-card--collapsed",id:"level-card-".concat(this.props.level.id)},s.a.createElement("div",{className:v,onClick:b},m,s.a.createElement("span",{className:"level-card--collapsed__name"},s.a.createElement(R,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})," ",this.props.level.name)),s.a.createElement("div",{className:"level-card--collapsed__actions"},s.a.createElement("div",{className:"actions__top btn-row"},this.props.levelProps.canDelete&&s.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableCardActions||this.props.rootStore.uiStore.activeCard,className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},s.a.createElement("i",{className:"fas fa-trash-alt"}),gettext("Delete")),this.props.levelProps.canEdit&&s.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableCardActions,className:"btn btn-sm btn-link btn-text edit-button",onClick:this.editLevel},s.a.createElement("i",{className:"fas fa-edit"}),gettext("Edit"))),s.a.createElement("div",{className:"actions__bottom"},s.a.createElement("a",{tabIndex:"0",className:g()("btn btn-sm btn-link no-bold",{disabled:y}),"data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-html":"true",title:gettext("Track indicator performance"),"data-content":u},d))))}}]),r}(s.a.Component))||o)||o,K=Object(p.b)("rootStore")(n=Object(p.c)(n=function(e){L(r,e);var t=I(r);function r(e){var o;return k(this,r),(o=t.call(this,e)).onDragEnd=function(e){var t=e.oldIndex,r=e.newIndex;o.indicatorWasReordered=!0;var n=o.indicators[t].id,i={value:r+1,name:r+1};o.changeIndicatorOrder(n,i)},o.changeIndicatorOrder=function(e,t){var r=o.indicators.find((function(t){return t.id==e})).level_order,n=t.value-1,i=o.indicators.slice();i.splice(n,0,i.splice(r,1)[0]),i.forEach((function(e,t){return e.level_order=t})),o.indicators.replace(i),o.props.rootStore.uiStore.activeCardNeedsConfirm=o.dataHasChanged,o.indicatorWasReordered=!0},o.updateSubmitType=function(e){o.submitType=e},o.saveLevel=function(e){e.preventDefault();var t=function(e){o.props.rootStore.levelStore.saveLevelToDB(o.submitType,o.props.level.id,o.indicatorWasReordered,{name:o.name,assumptions:o.assumptions,rationale:e,indicators:Object(f.r)(o.indicators)})},r=o.indicators.length>0,n=o.props.level.assumptions.length>0&&o.assumptions!=o.props.level.assumptions,i=o.name!=o.props.level.name;r&&(n||i)?Object(O.a)({header:gettext("Reason for change"),show_icon:!0,message_text:gettext("Your changes will be recorded in a change log.  For future reference, please share your reason for these changes."),include_rationale:!0,rationale_required:!0,notice_type:"notice",on_submit:t,on_cancel:function(){return o.props.rootStore.uiStore.setDisableCardActions(!1)}}):t("")},o.cancelEdit=function(){1==o.props.rootStore.levelStore.levels.length&&"new"==o.props.level.id?o.clearData():o.props.rootStore.levelStore.cancelEdit(o.props.level.id)},o.clearData=function(){o.name="",o.assumptions=""},o.onFormChange=function(e){if(e.preventDefault(),o[e.target.name]=e.target.value,o.name)$("#level-name-".concat(o.props.level.id)).removeClass("is-invalid"),$("#name-feedback-".concat(o.props.level.id)).remove();else{var t=$("#level-name-".concat(o.props.level.id));t.addClass("is-invalid");var r=gettext("Please complete this field.");t.after("<p id=name-feedback-".concat(o.props.level.id,' class="invalid-feedback">').concat(r,"</p>"))}o.props.rootStore.uiStore.activeCardNeedsConfirm=o.dataHasChanged},o.onProgramObjectiveImport=function(e){var t=o.props.rootStore.levelStore.programObjectives.find((function(t){return t.id===e}));null!=t&&(o.name=t.name,o.assumptions=t.description)},o.submitType="saveOnly",o.indicatorWasReordered=!1,o.baseLevelString=JSON.stringify([e.level.name,e.level.assumptions]),o.baseIndicators=o.props.levelProps.indicators.slice().map((function(e){return Object(f.r)(e)})),Object(f.i)(D(o),{name:e.level.name,assumptions:e.level.assumptions,indicators:e.levelProps.indicators.sort((function(e,t){return e.level_order-t.level_order})),get dataHasChanged(){var e=this.baseLevelString+JSON.stringify(this.baseIndicators.sort((function(e,t){return e.id-t.id})));return JSON.stringify([this.name,this.assumptions])+JSON.stringify(Object(f.r)(this.indicators).sort((function(e,t){return e.id-t.id})))!=e},addIndicator:function(e){this.indicators.push(e),this.baseIndicators.push(e)},deleteIndicator:function(e){this.indicators=this.indicators.filter((function(t){return t.id!=e})),this.indicators.forEach((function(e,t){return e.level_order=t})),this.baseIndicators=this.baseIndicators.filter((function(t){return t.id!=e})),this.baseIndicators.forEach((function(e,t){return e.level_order=t}))},updateIndicatorName:function(e,t){this.indicators.find((function(t){return t.id==e})).name=t,this.baseIndicators.find((function(t){return t.id==e})).name=t,this.props.rootStore.levelStore.updateIndicatorNameInStore(e,t)}},{addIndicator:f.d,deleteIndicator:f.d,updateIndicatorName:f.d}),o}return j(r,[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidMount",value:function(){var e=this;$('*[data-toggle="popover"]').popover({html:!0}),$("#indicator_modal_div").on("created.tola.indicator.save",(function(t,r){var o={id:r.indicatorId,name:r.indicatorName,level:e.props.level.id,level_order:e.indicators.length};e.props.rootStore.levelStore.addIndicatorToStore(o),e.addIndicator(o)})),$("#indicator_modal_div").on("deleted.tola.indicator.save",(function(t,r){e.props.rootStore.levelStore.deleteIndicatorFromStore(r.indicatorId),e.deleteIndicator(r.indicatorId)})),$("#indicator_modal_div").on("updated.tola.indicator.save",(function(t,r){e.updateIndicatorName(r.indicatorId,r.indicatorName),r.levelId!=e.props.rootStore.uiStore.activeCard&&(r.levelId&&e.props.rootStore.levelStore.moveIndicatorInStore(r.indicatorId,r.levelId),e.deleteIndicator(r.indicatorId)),$('*[data-toggle="tooltip"]').tooltip("dispose"),$('*[data-toggle="tooltip"]').tooltip()}))}},{key:"componentWillUnmount",value:function(){$("#indicator_modal_div").off("updated.tola.indicator.save"),$("#indicator_modal_div").off("deleted.tola.indicator.save"),$("#indicator_modal_div").off("created.tola.indicator.save")}},{key:"render",value:function(){var e=this,t=(Object(f.r)(this.indicators),this.props.rootStore.uiStore.disableCardActions),r=this.props.rootStore.levelStore.programObjectives,o="";return o="new"==this.props.level.id?s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit",disabled:0==this.name.length||t,className:"btn btn-link btn-lg ",onClick:function(t){e.updateSubmitType("saveAndEnableIndicators")}},s.a.createElement("i",{className:"fas fa-plus-circle"}),interpolate(gettext("Save %s and add indicators"),[this.props.levelProps.tierName]))):s.a.createElement(q,{level:this.props.level,tierName:this.props.levelProps.tierName,indicators:this.indicators,disabled:!this.name||"new"==this.props.level.id||this.props.rootStore.uiStore.disableCardActions,reorderDisabled:this.indicators.length<2||this.props.rootStore.uiStore.disableCardActions,changeFunc:this.changeIndicatorOrder,dragEndFunc:this.onDragEnd}),s.a.createElement("div",{className:"level-card level-card--expanded",id:"level-card-".concat(this.props.level.id)},s.a.createElement("div",{className:"d-flex justify-content-between"},s.a.createElement(R,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"}),s.a.createElement(B,{isDisabled:this.props.rootStore.uiStore.disableCardActions,programObjectives:r,onProgramObjectiveImport:this.onProgramObjectiveImport})),s.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},s.a.createElement("div",{className:"form-group"},s.a.createElement(T.a,{className:"form-control",id:"level-name-".concat(this.props.level.id),name:"name",value:this.name||"",disabled:this.props.rootStore.uiStore.disableCardActions,autoComplete:"off",rows:3,onChange:this.onFormChange,maxLength:500})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"assumptions"},gettext("Assumptions")),s.a.createElement(T.a,{className:"form-control",id:"level-assumptions",disabled:!this.name||this.props.rootStore.uiStore.disableCardActions,name:"assumptions",autoComplete:"off",value:this.assumptions||"",rows:3,onChange:this.onFormChange})),o,s.a.createElement(V,{level:this.props.level,levelProps:this.props.levelProps,submitFunc:this.updateSubmitType,cancelFunc:this.cancelEdit,nameVal:this.name,tierCount:this.props.rootStore.levelStore.chosenTierSet.length})))}}]),r}(s.a.Component))||n)||n,V=Object(p.b)("rootStore")(i=function(e){L(r,e);var t=I(r);function r(){return k(this,r),t.apply(this,arguments)}return j(r,[{key:"render",value:function(){var e=!this.props.nameVal||this.props.rootStore.uiStore.disableCardActions,t=null;if(null!=this.props.level.parent&&"root"!=this.props.level.parent){var r=interpolate(gettext("Save and add another %s"),[this.props.levelProps.tierName]);t=s.a.createElement(M,{disabled:e,classes:"btn-primary",icon:"plus-circle",text:r,submitType:"saveAndAddSibling",submitFunc:this.props.submitFunc})}var o=null,n=this.props.rootStore.levelStore.chosenTierSet.length;if(this.props.level.level_depth<n){var i=interpolate(gettext("Save and link %s"),[this.props.levelProps.childTierName]);o=s.a.createElement(M,{disabled:e,classes:"btn btn-primary",icon:"stream",text:i,submitType:"saveAndAddChild",submitFunc:this.props.submitFunc})}return s.a.createElement("div",{className:"button-bar btn-row"},s.a.createElement(M,{disabled:e,classes:"btn-primary",text:gettext("Save and close"),icon:"save",submitType:"saveOnly",submitFunc:this.props.submitFunc}),t,o,s.a.createElement(M,{disabled:this.props.rootStore.uiStore.disableCardActions,classes:"btn btn-reset",text:gettext("Cancel"),submitType:"cancel",submitFunc:this.props.cancelFunc}))}}]),r}(s.a.Component))||i,M=function(e){L(r,e);var t=I(r);function r(){return k(this,r),t.apply(this,arguments)}return j(r,[{key:"render",value:function(){var e=this,t="cancel"==this.props.submitType?"button":"submit";return s.a.createElement("button",{disabled:this.props.disabled,type:t,className:this.props.classes+" level-button btn btn-sm",onClick:function(){return e.props.submitFunc(e.props.submitType)}},this.props.text)}}]),r}(s.a.Component),q=Object(p.b)("rootStore")(a=function(e){L(r,e);var t=I(r);function r(){return k(this,r),t.apply(this,arguments)}return j(r,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0}),$('*[data-toggle="tooltip"]').tooltip()}},{key:"componentDidUpdate",value:function(){$('*[data-toggle="tooltip"]').tooltip()}},{key:"render",value:function(){var e=this,t=this.props.indicators.map((function(e,t){return{value:t+1,label:t+1}})),r=this.props.indicators.map((function(r){var o=s.a.createElement("span",{"data-toggle":"tooltip","data-delay":900,"data-template":'<div class="tooltip sortable-list__item__tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',title:r.name},s.a.createElement("span",null,r.name.replace(/(.{55})..+/,"$1...")));return s.a.createElement(s.a.Fragment,null,s.a.createElement(y.d,{update:function(t){return e.props.changeFunc(r.id,t)},selectId:"ind"+r.id,labelClasses:" ",formRowClasses:"sortable-list__item__label",selectClasses:"sortable-list__item__select",value:{value:r.level_order,label:r.level_order+1},label:o,options:t,disabled:e.props.disabled||e.props.reorderDisabled}),s.a.createElement("div",{className:"sortable-list__item__actions"},s.a.createElement(S.d,{readonly:e.props.disabled||e.props.rootStore.uiStore.disableCardActions,label:gettext("Settings"),indicatorId:r.id})))})),o=null,n=null,i=gettext("To link an already saved indicator to your results framework: Open the indicator from the program page and use the “Result level” menu on the Summary tab."),a=gettext("To remove an indicator: Click “Settings”, where you can reassign the indicator to a different level or delete it."),l=this.props.rootStore.levelStore.usingResultsFramework,c=l?a:i+"<br><br>"+a;return(this.props.indicators.length>0||!l)&&(o="Order",n=s.a.createElement(E.b,{content:c,placement:"bottom"})),s.a.createElement("div",{className:"level-card--indicator-links".concat(this.props.disabled?" disabled":"")},s.a.createElement("div",{className:"indicator-links__header"},s.a.createElement("h4",null,interpolate(gettext("Indicators linked to this %s"),[this.props.tierName])),s.a.createElement("div",null,n)),s.a.createElement("div",{className:"sortable-list-group"},this.props.indicators.length>0?s.a.createElement("div",{className:"sortable-list-header"},s.a.createElement("div",{className:"sortable-list-header__drag-handle"},s.a.createElement(h.a,{icon:v.a})),s.a.createElement("div",{className:"sortable-list-header__label"},o),s.a.createElement("div",{className:"sortable-list-header__actions"},s.a.createElement("i",{className:"fas fa-cog"})," ",gettext("Settings"))):null,s.a.createElement(U,{onSortEnd:this.props.dragEndFunc,useDragHandle:!0,lockAxis:"y",lockToContainerEdges:!0},r.map((function(t,r){return s.a.createElement(H,{key:"item-".concat(r),index:r,value:t,disabled:e.props.disabled||e.props.reorderDisabled})}))),s.a.createElement("div",{className:"sortable-list-actions"},s.a.createElement(S.a,{readonly:!this.props.level.id||"new"==this.props.level.id||this.props.disabled||this.props.rootStore.uiStore.disableCardActions,programId:this.props.rootStore.levelStore.program_id,levelId:this.props.level.id}))))}}]),r}(s.a.Component))||a,H=Object(_.b)((function(e){var t=e.value;return s.a.createElement("li",{className:"sortable-list__item"},s.a.createElement(W,null),t)})),U=Object(_.a)((function(e){var t=e.children;return s.a.createElement("ul",{className:"sortable-list"},t)})),W=Object(_.c)((function(){return s.a.createElement("div",{className:"sortable-list__item__drag-handle"},s.a.createElement(h.a,{icon:v.a}))}));function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Y(e,t,r){return t&&Q(e.prototype,t),r&&Q(e,r),e}function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=re(e);if(t){var n=re(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return te(this,r)}}function te(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}m.b.add(v.f,v.d),m.b.add(v.f,v.d);var oe,ne,ie=function(e){X(r,e);var t=ee(r);function r(){return G(this,r),t.apply(this,arguments)}return Y(r,[{key:"render",value:function(){var e=g()("btn-delete btn btn-sm text-danger",this.props.buttonClasses),t=g()("fa fa-times",this.props.iconClasses);return s.a.createElement("button",{type:this.props.type||"button",onClick:this.props.action,onKeyUp:this.props.action,className:e},s.a.createElement("i",{className:t}))}}]),r}(s.a.Component),ae=function(e){X(r,e);var t=ee(r);function r(){return G(this,r),t.apply(this,arguments)}return Y(r,[{key:"render",value:function(){return s.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:this.props.expandFunc,disabled:this.props.isDisabled},s.a.createElement(h.a,{icon:"plus-square"}),gettext("Expand all"))}}]),r}(s.a.Component),le=function(e){X(r,e);var t=ee(r);function r(){return G(this,r),t.apply(this,arguments)}return Y(r,[{key:"render",value:function(){return s.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:this.props.collapseFunc,disabled:this.props.isDisabled},s.a.createElement(h.a,{icon:"minus-square"}),gettext("Collapse all"))}}]),r}(s.a.Component);function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function pe(e,t,r){return t&&ue(e.prototype,t),r&&ue(e,r),e}function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=he(e);if(t){var n=he(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return ve(this,r)}}function ve(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}m.b.add(v.b,v.c,v.g);var be,ge,ye,Se=Object(p.b)("rootStore")(oe=Object(p.c)(oe=function(e){de(r,e);var t=me(r);function r(){return ce(this,r),t.apply(this,arguments)}return pe(r,[{key:"render",value:function(){var e=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.sortedLevels.filter((function(e){return-1!=["root",null].indexOf(e.parent)})):this.props.renderList.sort((function(e,t){return e.customsort-t.customsort}))).map((function(t){var o="";o=e.props.rootStore.uiStore.activeCard==t.id?s.a.createElement(K,{level:t,levelProps:e.props.rootStore.levelStore.levelProperties[t.id]}):s.a.createElement(z,{level:t,levelProps:e.props.rootStore.levelStore.levelProperties[t.id]});var n=e.props.rootStore.levelStore.sortedLevels.filter((function(e){return e.parent==t.id})),i=null;return n.length>0&&(i=s.a.createElement(r,{rootStore:e.props.rootStore,renderList:n})),s.a.createElement("div",{key:t.id,className:"leveltier--new"},o,i)}))}}]),r}(s.a.Component))||oe)||oe,_e=Object(p.b)("rootStore")(ne=Object(p.c)(ne=function(e){de(r,e);var t=me(r);function r(){var e;ce(this,r);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).getWarningText=function(){return{__html:e.props.rootStore.uiStore.splashWarning}},e}return pe(r,[{key:"render",value:function(){var e=this,t=0===this.props.rootStore.uiStore.hasVisibleChildren.length||this.props.rootStore.uiStore.disableCardActions||this.props.rootStore.uiStore.activeCard,r=null;if(this.props.rootStore.levelStore.levels.filter((function(e){return"new"!==e.id})).length>1){r=s.a.createElement("div",{className:"level-list--expandos"},s.a.createElement("div",{className:"btn-group"},s.a.createElement(ae,{isDisabled:this.props.rootStore.uiStore.isExpandAllDisabled,expandFunc:this.props.rootStore.uiStore.expandAllLevels}),s.a.createElement(le,{isDisabled:t,collapseFunc:this.props.rootStore.uiStore.collapseAllLevels})),s.a.createElement("div",{className:"level-list--action-buttons"},s.a.createElement("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:function(){window.open(e.props.rootStore.levelStore.excelURL,"_blank")}},s.a.createElement("i",{className:"fas fa-download"}),gettext("Excel"))))}return 0==this.props.rootStore.levelStore.levels.length?s.a.createElement("div",{className:"level-list-panel"},s.a.createElement("div",{className:"level-list-panel__dingbat"},s.a.createElement(h.a,{icon:"sitemap"})),s.a.createElement("div",{className:"level-list-panel__text text-large",dangerouslySetInnerHTML:this.getWarningText()})):s.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},r,s.a.createElement(Se,{renderList:"initial"}))}}]),r}(s.a.Component))||ne)||ne;function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Te(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function we(e,t,r){return t&&Te(e.prototype,t),r&&Te(e,r),e}function Oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}function xe(e,t){return(xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=je(e);if(t){var n=je(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return Ne(this,r)}}function Ne(e,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Le,Pe=function(e){Oe(r,e);var t=ke(r);function r(){return Ce(this,r),t.apply(this,arguments)}return we(r,[{key:"render",value:function(){return s.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),r}(s.a.Component),Ie=Object(p.b)("rootStore")(be=Object(p.c)(be=function(e){Oe(r,e);var t=ke(r);function r(){return Ce(this,r),t.apply(this,arguments)}return we(r,[{key:"render",value:function(){var e=null;0===this.props.rootStore.levelStore.levels.length&&this.props.rootStore.levelStore.hasEditPermissions&&(e=s.a.createElement("div",{className:"leveltier-list__actions"},s.a.createElement("button",{className:"leveltier-button btn btn-primary btn-block",onClick:this.props.rootStore.levelStore.applyTierSet},gettext("Apply"))));var t=null;return this.props.rootStore.levelStore.chosenTierSetKey==this.props.rootStore.levelStore.customTierSetKey&&this.props.rootStore.levelStore.useStaticTierList&&this.props.rootStore.levelStore.hasEditPermissions&&(t=s.a.createElement("button",{className:"btn btn-link leveltier-list leveltier--editable__settings",onClick:this.props.rootStore.levelStore.editTierSet},s.a.createElement("i",{className:"fa fa-cog"}),gettext("Settings"))),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},this.props.rootStore.levelStore.chosenTierSet.length>0?this.props.rootStore.levelStore.chosenTierSet.map((function(e,t){return s.a.createElement(Pe,{key:t,tierLevel:t,tierName:e})})):null),t,e)}}]),r}(s.a.Component))||be)||be,Ae=Object(p.b)("rootStore")(ge=function(e){Oe(r,e);var t=ke(r);function r(e){var o;return Ce(this,r),(o=t.call(this,e)).onBlur=function(e){e.relatedTarget&&e.relatedTarget.classList.contains("btn-delete")?o.props.rootStore.levelStore.deleteCustomTier(e):(o.props.rootStore.uiStore.validateCustomTiers(),e.relatedTarget&&"applyButton"==e.relatedTarget.id&&o.props.rootStore.levelStore.applyTierSet(),e.relatedTarget&&"addLevelButton"==e.relatedTarget.id&&o.props.rootStore.levelStore.addCustomTier())},o.inputRef=s.a.createRef(),o}return we(r,[{key:"componentDidMount",value:function(){this.inputRef.current.focus()}},{key:"render",value:function(){var e=null;this.props.showDeleteButton&&(e=s.a.createElement(ie,{buttonClasses:"p-0",type:"button",disabled:this.props.rootStore.uiStore.customFormErrors.hasErrors,action:this.props.rootStore.levelStore.deleteCustomTier}));var t=null;return this.props.showLockButton&&(t=s.a.createElement("a",{tabIndex:"0",className:"btn btn-sm btn-link","data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-content":gettext("This level is being used in the results framework")},s.a.createElement("i",{className:"fa fa-lock text-muted"}))),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{className:"leveltier--editable__label"},interpolate(gettext("Level %s"),[this.props.tierOrder+1])),s.a.createElement("div",{className:"leveltier--editable"},s.a.createElement("input",{ref:this.inputRef,className:"leveltier--editable__input form-control",type:"text",maxLength:75,"data-tierorder":this.props.tierOrder,value:this.props.tierName,onChange:this.props.rootStore.levelStore.updateCustomTier,onBlur:this.onBlur}),e,t),s.a.createElement("span",{className:"has-error"},this.props.errorMsg)))}}]),r}(s.a.Component))||ge,De=Object(p.b)("rootStore")(ye=Object(p.c)(ye=function(e){Oe(r,e);var t=ke(r);function r(){var e;Ce(this,r);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).customTemplateFormSubmit=function(e){return e.preventDefault()},e}return we(r,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e=this,t=this.props.rootStore.levelStore.customTierSetKey,r=this.props.rootStore.levelStore.chosenTierSet.map((function(t,r){var o=e.props.rootStore.uiStore.customFormErrors.errors.length>r?e.props.rootStore.uiStore.customFormErrors.errors[r]:null,n=o&&o.hasError?o.msg:null,i=!e.props.rootStore.levelStore.tierIsDeletable(r+1),a=!(r!==e.props.rootStore.levelStore.chosenTierSet.length-1||i||1===e.props.rootStore.levelStore.chosenTierSet.length&&0===t.length);return s.a.createElement(Ae,{key:r,tierName:t,showDeleteButton:a,showLockButton:i,tierOrder:r,errorMsg:n})}))||null,o=!this.props.rootStore.levelStore.tierTemplates[t].tiers.every((function(e){return e.length>0}))||this.props.rootStore.uiStore.addLevelButtonIsLocked,n=r.length>=this.props.rootStore.levelStore.maxTiers?null:s.a.createElement("button",{id:"addLevelButton",type:"button",className:"btn btn-link btn-add",disabled:o,onClick:this.props.rootStore.levelStore.addCustomTier},s.a.createElement("i",{className:"fa fa-plus-circle"}),"Add level"),i=s.a.createElement("div",{className:"leveltier-list__actions"},s.a.createElement("button",{id:"applyButton",className:"leveltier-button btn btn-primary btn-block",disabled:o,type:"button",onClick:this.props.rootStore.levelStore.applyTierSet},gettext("Apply")));return s.a.createElement("form",{onSubmit:this.customTemplateFormSubmit},s.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},s.a.createElement("div",{className:""},r),n),i)}}]),r}(s.a.Component))||ye)||ye;function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ze(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=Me(e);if(t){var n=Me(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return Ve(this,r)}}function Ve(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qe,He,Ue,We,Je,Ge,Qe,Ye,Xe,Ze,et,tt,rt,ot,nt,it,at,lt,st,ct,ut,pt,dt,ft,mt,vt,ht,bt,gt,yt,St,_t,Et,Ct,Tt,wt=Object(p.b)("rootStore")(Le=Object(p.c)(Le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(i,e);var t,r,o,n=$e(i);function i(){var e;Be(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=n.call.apply(n,[this].concat(r))).handleChange=function(t){e.props.rootStore.levelStore.changeTierSet(t.value)},e}return t=i,(r=[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e=null;if("locked"==this.props.rootStore.uiStore.tierLockStatus){var t=this.props.rootStore.levelStore.chosenTierSet[0],r=this.props.rootStore.levelStore.chosenTierSet[1];e=s.a.createElement(E.b,{key:1,content:interpolate(gettext('<span class="text-danger"><strong>The results framework template is locked as soon as the first %(secondTier)s is saved.</strong></span> To change templates, all saved levels must be deleted except for the original %(firstTier)s. A level can only be deleted when it has no sub-levels and no linked indicators.'),{secondTier:r,firstTier:t},!0)})}else"primed"==this.props.rootStore.uiStore.tierLockStatus&&(e=s.a.createElement(E.b,{key:2,content:this.props.rootStore.uiStore.splashWarning}));var o=this.props.rootStore.levelStore.tierTemplates,n=o.custom,i=Re(o,["custom"]),a=Object.keys(i).sort().map((function(e){return{value:e,label:o[e].name}}));a.push({label:"-----------------------------------------------------------",options:[{value:this.props.rootStore.levelStore.customTierSetKey,label:n.name}]});var l={value:this.props.rootStore.levelStore.chosenTierSetKey,label:this.props.rootStore.levelStore.chosenTierSetName},c="leveltier-picker__selectbox ";return c+="locked"==this.props.rootStore.uiStore.tierLockStatus?"leveltier-picker__selectbox--disabled":"",s.a.createElement("div",{className:c},s.a.createElement("div",{className:"form-group"},s.a.createElement("label",null,gettext("Results framework template"))," ",s.a.createElement("small",null,e),s.a.createElement(w.a,{maxMenuHeight:350,options:a,value:l,isDisabled:"locked"==this.props.rootStore.uiStore.tierLockStatus,isSearchable:!1,onChange:this.handleChange})))}}])&&ze(t.prototype,r),o&&ze(t,o),i}(s.a.Component))||Le)||Le,Ot=function(e){var t=e.programId,r="/tola_management/audit_log/".concat(t,"/");return s.a.createElement("div",{className:"leveltier-picker__change-log-link-box"},s.a.createElement("a",{href:r,className:"btn-link"},s.a.createElement("i",{className:"fas fa-history"})," ",gettext("Change log")))},xt=Object(p.b)("rootStore")(Object(p.c)((function(e){var t=s.a.createElement(Ie,null);return this.props.rootStore.levelStore.chosenTierSetKey==this.props.rootStore.levelStore.customTierSetKey&&!this.props.rootStore.levelStore.useStaticTierList&&this.props.rootStore.levelStore.hasEditPermissions&&(t=s.a.createElement(De,null)),s.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},s.a.createElement("div",{className:"leveltier-picker__panel"},s.a.createElement(wt,null),t),s.a.createElement(Ot,{programId:e.rootStore.levelStore.program_id}))}))),kt=r("XoI5");function Nt(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=Lt(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}function jt(e){return function(e){if(Array.isArray(e))return Pt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Lt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(e,t){if(e){if("string"==typeof e)return Pt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pt(e,t):void 0}}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function It(e,t,r,o){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(o):void 0})}function At(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Dt(e,t,r){return t&&At(e.prototype,t),r&&At(e,r),e}function Ft(e,t,r,o,n){var i={};return Object.keys(o).forEach((function(e){i[e]=o[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,o){return o(e,t,r)||r}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}function Rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Bt=(He=Ft((qe=function(){function e(t,r,o,n,i,a,l,s,c,u,p,d){var m=this;if(Rt(this,e),It(this,"levels",He,this),It(this,"indicators",Ue,this),It(this,"chosenTierSetKey",We,this),It(this,"useStaticTierList",Je,this),It(this,"formErrors",Ge,this),It(this,"tierTemplates",Qe,this),this.program_id=void 0,this.tierTemplates=void 0,this.programObjectives=void 0,this.defaultTemplateKey="",this.customTierSetKey="",this.accessLevel=!1,this.usingResultsFramework=void 0,this.monitorHeaderLink=Object(f.e)((function(e){var t=$("#rf_builder_header"),r=t.children("a").length>0;if(m.indicators.length>0&&!r){var o=t.text();t.html('<a href="/program/'.concat(m.program_id,'/">').concat(o,"</a>"))}else if(0==m.indicators.length&&r){var n=$("#rf_builder_header > a").text();t.text(n)}}),{delay:50}),It(this,"updateCustomTier",Ye,this),It(this,"addCustomTier",Xe,this),It(this,"deleteCustomTier",Ze,this),It(this,"applyTierSet",et,this),It(this,"editTierSet",tt,this),this.saveCustomTemplateToDB=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.addTier,r=e.isDeleting,o=e.shouldAlert;if(r||(m.rootStore.uiStore.validateCustomTiers(),!m.rootStore.uiStore.customFormErrors.hasErrors)){var n=jt(m.tierTemplates[m.customTierSetKey].tiers);0===n[0].length&&(n=null);var i={program_id:m.program_id,tiers:n};kt.a.post("/save_custom_template/",i).then((function(e){o&&success_notice({message_text:gettext("Changes to the results framework template were saved."),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}}),t&&""!=m.chosenTierSet.slice(-1)&&m.chosenTierSet.push(""),m.rootStore.uiStore.setAddLevelButtonLockedStatus(!1)})).catch((function(e){m.rootStore.uiStore.setAddLevelButtonLockedStatus(!1),console.log("error",e)}))}},It(this,"cancelEdit",rt,this),It(this,"createNewLevelFromSibling",ot,this),It(this,"createNewLevelFromParent",nt,this),It(this,"createFirstLevel",it,this),this.saveLevelTiersToDB=function(){var e={program_id:m.program_id};return m.chosenTierSetKey===m.customTierSetKey?e.tiers=m.chosenTierSet:e.tiers=m.englishTierTemlates[m.chosenTierSetKey].tiers,kt.a.post("/save_leveltiers/",e)},this.deleteLevelFromDB=function(e){var t="".concat(m.levelProperties[e].tierName," ").concat(m.levelProperties[e].ontologyLabel);kt.a.delete("/level/".concat(e)).then((function(e){m.levels.replace(e.data),m.rootStore.uiStore.activeCard=null,0==m.levels.length&&m.createFirstLevel(),success_notice({message_text:interpolate(gettext("%s was deleted."),[t]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})})).catch((function(e){return console.log("error",e)})),m.rootStore.uiStore.setDisableCardActions(!1)},this.saveLevelToDB=function(e,t,r,o){r&&m.saveReorderedIndicatorsToDB(o.indicators),delete o.indicators;var n=m.levels.find((function(e){return e.id==t})),i="".concat(m.levelProperties[t].tierName," ").concat(m.levelProperties[t].ontologyLabel),a=Object.assign(Object(f.r)(n),o),l=m.rootStore.uiStore.activeCardNeedsConfirm;"new"==t?("root"==a.parent&&$("#logframe_link").show(),delete a.id,delete a.rationale,kt.a.post("/insert_new_level/",a).then((function(t){Object(f.p)((function(){m.levels.replace(t.data.all_data)})),success_notice({message_text:interpolate(gettext("%s saved."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}});var r=t.data.new_level.id;m.rootStore.uiStore.activeCard=null,"saveAndEnableIndicators"==e?Object(f.p)((function(){m.rootStore.uiStore.activeCard=r})):"saveAndAddSibling"==e?m.createNewLevelFromSibling(r):"saveAndAddChild"==e&&m.createNewLevelFromParent(r)})).catch((function(e){return console.log("error",e)}))):kt.a.put("/level/".concat(t,"/"),a).then((function(o){(l||r)&&success_notice({message_text:interpolate(gettext("%s updated."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}}),Object(f.p)((function(){Object.assign(n,o.data)})),m.rootStore.uiStore.activeCard=null,"saveAndAddSibling"==e?m.createNewLevelFromSibling(t):"saveAndAddChild"==e&&m.createNewLevelFromParent(t)})).catch((function(e){console.log("There was an error:",e)})),m.fetchIndicatorsFromDB(),m.rootStore.uiStore.activeCardNeedsConfirm=!1},this.saveReorderedIndicatorsToDB=function(e){kt.a.post("/reorder_indicators/",e).then((function(e){m.fetchIndicatorsFromDB()})).catch((function(e){console.log("There was an error:",e)}))},It(this,"deleteIndicatorFromStore",at,this),It(this,"addIndicatorToStore",lt,this),It(this,"moveIndicatorInStore",st,this),this.fetchIndicatorsFromDB=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e?"?indicatorId=".concat(e):"";kt.a.get("/indicator_list/".concat(m.program_id,"/").concat(t)).then((function(e){return Object(f.p)((function(){m.indicators=e.data}))})).catch((function(e){return console.log("There was an error:",e)}))},this.deriveTemplateKey=function(e){var t=JSON.stringify(Object(f.r)(e));for(var r in m.englishTierTemlates){if(m.englishTierTemlates.hasOwnProperty(r)&&e.length==m.englishTierTemlates[r].tiers.length)if(t==JSON.stringify(m.englishTierTemlates[r].tiers))return r}return m.customTierSetKey},this.buildOntology=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Object(f.r)(m.levels.find((function(t){return t.id==e})));return r.parent&&"root"!=r.parent?(t.unshift(r.customsort),m.buildOntology(r.parent,t)):t.join(".")},this.getChildLevels=function(e){return m.levels.filter((function(t){return t.parent==e}))},this.getLevelIndicators=function(e){return m.indicators.filter((function(t){return t.level==e}))},this.getDescendantIndicatorIds=function(e){var t=m.levels.filter((function(t){return e.includes(t.id)})),r=[];return t.forEach((function(e){r=r.concat(m.indicators.filter((function(t){return t.level==e.id})).map((function(e){return e.id})));var t=m.levels.filter((function(t){return t.parent==e.id})).map((function(e){return e.id}));r=r.concat(m.getDescendantIndicatorIds(t,r))})),r},this.tierIsDeletable=function(e){var t,r=Nt(m.levels);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.level_depth===e&&o.name.length>0)return!1}}catch(e){r.e(e)}finally{r.f()}return!0},this.rootStore=d,this.levels=r,this.indicators=o,this.englishTierTemlates=JSON.parse(a),this.defaultTemplateKey="mc_standard",this.customTierSetKey="custom",this.program_id=t.id,this.manual_numbering=t.manual_numbering,this.programObjectives=s,this.accessLevel=c,this.usingResultsFramework=u,this.formErrors={hasError:!1},this.maxTiers=p,this.excelURL="/indicators/results_framework_export/".concat(t.id,"/"),this.tierTemplates=JSON.parse(i),this.tierTemplates[this.customTierSetKey]={name:gettext("Custom")},this.tierTemplates[this.customTierSetKey].tiers=l.names||[""],n.length>0){var v=n.map((function(e){return e.name}));this.chosenTierSetKey=this.deriveTemplateKey(v)}else this.chosenTierSetKey=this.defaultTemplateKey;this.useStaticTierList=!(this.chosenTierSetKey===this.customTierSetKey&&0===this.levels.length)}return Dt(e,[{key:"changeTierSet",value:function(e){var t=this,r=this.chosenTierSet[0];(this.chosenTierSetKey=e,this.chosenTierSetKey===this.customTierSetKey?(this.editTierSet(),this.tierTemplates[this.customTierSetKey].tiers[0]||1!==this.levels.filter((function(e){return"new"!==e.id})).length||(this.tierTemplates[this.customTierSetKey].tiers=[gettext(r)])):(this.rootStore.uiStore.customFormErrors={hasErrors:!1,errors:[]},this.rootStore.uiStore.setDisableCardActions(!1)),this.levels.length>0&&this.chosenTierSetKey!==this.customTierSetKey)&&this.saveLevelTiersToDB().then((function(e){t.chosenTierSetKey!==t.customTierSetKey&&t.levels.filter((function(e){return"new"!==e.id})).length>0&&success_notice({message_text:gettext("Changes to the results framework template were saved."),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})})).catch((function(e){console.log("There was an error saving the template to the database")}))}},{key:"updateIndicatorNameInStore",value:function(e,t){this.indicators.find((function(t){return t.id==e})).name=t}},{key:"sortedLevels",get:function(){return this.levels.slice().sort((function(e,t){e.level_depth-t.level_depth||(e.customsort,t.customsort)}))}},{key:"chosenTierSet",get:function(){return this.tierTemplates[this.chosenTierSetKey].tiers}},{key:"levelProperties",get:function(){var e,t=this,r={},o=Nt(this.levels);try{var n=function(){var o=e.value,n={},i=t.getChildLevels(o.id).map((function(e){return e.id})),a=t.indicators.filter((function(e){return e.level==o.id}));n.indicators=t.getLevelIndicators(o.id),n.descendantIndicatorIds=t.getDescendantIndicatorIds(i),n.ontologyLabel=t.buildOntology(o.id),n.tierName=t.chosenTierSet[o.level_depth-1],n.childTierName=null,t.chosenTierSet.length>o.level_depth&&(n.childTierName=t.chosenTierSet[o.level_depth]),n.canDelete=0==i.length&&0==a&&t.hasEditPermissions,n.canEdit=t.hasEditPermissions,r[o.id]=n};for(o.s();!(e=o.n()).done;)n()}catch(e){o.e(e)}finally{o.f()}return r}},{key:"chosenTierSetName",get:function(){return this.tierTemplates[this.chosenTierSetKey].name}},{key:"hasEditPermissions",get:function(){return"high"===this.accessLevel}}]),e}()).prototype,"levels",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ue=Ft(qe.prototype,"indicators",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),We=Ft(qe.prototype,"chosenTierSetKey",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Je=Ft(qe.prototype,"useStaticTierList",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ge=Ft(qe.prototype,"formErrors",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe=Ft(qe.prototype,"tierTemplates",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ft(qe.prototype,"sortedLevels",[f.f],Object.getOwnPropertyDescriptor(qe.prototype,"sortedLevels"),qe.prototype),Ft(qe.prototype,"chosenTierSet",[f.f],Object.getOwnPropertyDescriptor(qe.prototype,"chosenTierSet"),qe.prototype),Ft(qe.prototype,"levelProperties",[f.f],Object.getOwnPropertyDescriptor(qe.prototype,"levelProperties"),qe.prototype),Ft(qe.prototype,"chosenTierSetName",[f.f],Object.getOwnPropertyDescriptor(qe.prototype,"chosenTierSetName"),qe.prototype),Ft(qe.prototype,"hasEditPermissions",[f.f],Object.getOwnPropertyDescriptor(qe.prototype,"hasEditPermissions"),qe.prototype),Ft(qe.prototype,"changeTierSet",[f.d],Object.getOwnPropertyDescriptor(qe.prototype,"changeTierSet"),qe.prototype),Ye=Ft(qe.prototype,"updateCustomTier",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.tierTemplates[e.customTierSetKey].tiers[t.target.dataset.tierorder]=t.target.value}}}),Xe=Ft(qe.prototype,"addCustomTier",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.rootStore.uiStore.setAddLevelButtonLockedStatus(!0),e.saveCustomTemplateToDB({addTier:!0})}}}),Ze=Ft(qe.prototype,"deleteCustomTier",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if(0===t.detail&&!t.key||t.key&&"Enter"!=t.key)return!1;1===e.chosenTierSet.length?(e.tierTemplates[e.customTierSetKey].tiers=[""],e.rootStore.uiStore.clearValidationMessages()):(e.tierTemplates[e.customTierSetKey].tiers.pop(),e.rootStore.uiStore.validateCustomTiers()),e.saveCustomTemplateToDB({isDeleting:!0})}}}),et=Ft(qe.prototype,"applyTierSet",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&t.preventDefault(),e.chosenTierSetKey===e.customTierSetKey&&e.rootStore.uiStore.customFormErrors.hasErrors)return!1;if(e.saveLevelTiersToDB(),e.chosenTierSetKey===e.customTierSetKey){if(e.rootStore.uiStore.validateCustomTiers(),e.rootStore.uiStore.customFormErrors.hasErrors)return;e.saveCustomTemplateToDB({shouldAlert:!0}),e.useStaticTierList=!0}0===e.levels.length&&e.createFirstLevel(),e.rootStore.uiStore.setDisableCardActions(!1)}}}),tt=Ft(qe.prototype,"editTierSet",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.useStaticTierList=!1,e.rootStore.uiStore.setDisableCardActions(!0)}}}),rt=Ft(qe.prototype,"cancelEdit",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if("new"==t){var r=e.levels.find((function(e){return e.id==t}));e.levels.filter((function(e){return e.customsort>r.customsort&&e.parent==r.parent})).forEach((function(e){return e.customsort-=1})),e.levels.replace(e.levels.filter((function(e){return"new"!=e.id})))}e.fetchIndicatorsFromDB(),e.rootStore.uiStore.removeActiveCard()}}}),ot=Ft(qe.prototype,"createNewLevelFromSibling",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var r=Object(f.r)(e.levels.find((function(e){return e.id==t}))),o=Object.assign({},r);o.customsort+=1,o.id="new",o.name="",o.assumptions="",e.levels.filter((function(e){return r&&e.customsort>r.customsort&&e.parent==r.parent})).forEach((function(e){return e.customsort+=1})),e.rootStore.uiStore.activeCard="new",e.levels.push(o),setTimeout((function(){$("#level-card-new")[0].scrollIntoView({behavior:"smooth"})}),100)}}}),nt=Ft(qe.prototype,"createNewLevelFromParent",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var r=Object(f.r)(e.levels.find((function(e){return e.id==t}))),o={id:"new",customsort:1,name:"",assumptions:"",parent:t,level_depth:r.level_depth+1,program:e.program_id};e.levels.filter((function(e){return e.parent==t})).forEach((function(e){return e.customsort+=1})),e.levels.push(o),e.rootStore.uiStore.activeCard="new",e.rootStore.uiStore.hasVisibleChildren.push(o.parent)}}}),it=Ft(qe.prototype,"createFirstLevel",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t={id:"new",program:e.program_id,name:"",assumptions:"",customsort:1,level_depth:1,parent:"root"};e.levels.push(t),e.rootStore.uiStore.activeCard="new"}}}),Ft(qe.prototype,"updateIndicatorNameInStore",[f.d],Object.getOwnPropertyDescriptor(qe.prototype,"updateIndicatorNameInStore"),qe.prototype),at=Ft(qe.prototype,"deleteIndicatorFromStore",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){e.indicators=e.indicators.filter((function(e){return e.id!=t})),e.indicators.filter((function(e){return e.level==r})).sort((function(e,t){return e.level_order-t.level_order})).forEach((function(e,t){return e.level_order=t}))}}}),lt=Ft(qe.prototype,"addIndicatorToStore",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.indicators.push(t)}}}),st=Ft(qe.prototype,"moveIndicatorInStore",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){var o=e.indicators.find((function(e){return e.id==t}));o.level=r,o.level_order=e.indicators.filter((function(e){return e.level==r})).length-1}}}),qe),zt=(ut=Ft((ct=function(){function e(t){Rt(this,e),It(this,"activeCard",ut,this),It(this,"hasVisibleChildren",pt,this),It(this,"disableCardActions",dt,this),It(this,"customFormErrors",ft,this),It(this,"addLevelButtonIsLocked",mt,this),this.activeCardNeedsConfirm="",It(this,"editCard",vt,this),It(this,"onLeaveConfirm",ht,this),It(this,"setDisableCardActions",bt,this),It(this,"removeActiveCard",gt,this),It(this,"updateVisibleChildren",yt,this),It(this,"expandAllLevels",St,this),It(this,"collapseAllLevels",_t,this),It(this,"setAddLevelButtonLockedStatus",Et,this),It(this,"validateCustomTiers",Ct,this),It(this,"clearValidationMessages",Tt,this),this.rootStore=t,this.hasVisibleChildren=this.rootStore.levelStore.levels.map((function(e){return e.id})),this.activeCardNeedsConfirm=!1,this.activeCard=null,this.disableCardActions=!1,this.customFormErrors={hasErrors:!1,errors:[]},this.addLevelButtonIsLocked=!1,this.splashWarning=gettext('<strong class="text-danger">Choose your results framework template carefully!</strong> Once you begin building your framework, it will not be possible to change templates without first deleting saved levels.')}return Dt(e,[{key:"tierLockStatus",get:function(){return!this.rootStore.levelStore.hasEditPermissions||this.rootStore.levelStore.levels.length>1?"locked":this.rootStore.levelStore.levels.length>0?"primed":null}},{key:"isExpandAllDisabled",get:function(){if(0==this.rootStore.levelStore.levels.length||this.disableCardActions||this.activeCard)return!0;var e=new Set(this.rootStore.levelStore.levels.map((function(e){return e.parent})));e=Array.from(e).filter((function(e){return null!=e}));var t,r=new Set(jt(this.hasVisibleChildren)),o=Nt(e);try{for(o.s();!(t=o.n()).done;){var n=t.value;if(!r.has(n))return!1}}catch(e){o.e(e)}finally{o.f()}return!0}},{key:"disabledActionsOrActiveCard",get:function(){return this.disableCardActions||this.activeCard}}]),e}()).prototype,"activeCard",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt=Ft(ct.prototype,"hasVisibleChildren",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dt=Ft(ct.prototype,"disableCardActions",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=Ft(ct.prototype,"customFormErrors",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Ft(ct.prototype,"addLevelButtonIsLocked",[f.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft(ct.prototype,"tierLockStatus",[f.f],Object.getOwnPropertyDescriptor(ct.prototype,"tierLockStatus"),ct.prototype),Ft(ct.prototype,"isExpandAllDisabled",[f.f],Object.getOwnPropertyDescriptor(ct.prototype,"isExpandAllDisabled"),ct.prototype),Ft(ct.prototype,"disabledActionsOrActiveCard",[f.f],Object.getOwnPropertyDescriptor(ct.prototype,"disabledActionsOrActiveCard"),ct.prototype),vt=Ft(ct.prototype,"editCard",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var r=e.activeCard;if(e.activeCardNeedsConfirm){e.setDisableCardActions(!0),$("#level-card-".concat(e.activeCard))[0].scrollIntoView({behavior:"smooth"});var o=e.rootStore.levelStore.levelProperties[e.activeCard].tierName;Object(O.a)({header:gettext("Warning"),show_icon:!0,message_text:gettext("Are you sure you want to continue?"),preamble:interpolate(gettext("Changes to this %s will not be saved"),[o]),notice_type:"notice",include_rationale:!1,rationale_required:!1,on_submit:function(){return e.onLeaveConfirm(t,r)},on_cancel:function(){return e.setDisableCardActions(!1)}})}else e.activeCard=t,e.rootStore.levelStore.levels.replace(e.rootStore.levelStore.levels.filter((function(e){return"new"!=e.id})))}}}),ht=Ft(ct.prototype,"onLeaveConfirm",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){e.setDisableCardActions(!1),e.rootStore.levelStore.cancelEdit(r),e.activeCardNeedsConfirm=!1,e.activeCard=t,setTimeout((function(){$("#level-card-".concat(t))[0].scrollIntoView({behavior:"smooth"})}),100)}}}),bt=Ft(ct.prototype,"setDisableCardActions",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.disableCardActions=t}}}),gt=Ft(ct.prototype,"removeActiveCard",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.activeCard=null,e.rootStore.uiStore.activeCardNeedsConfirm=!1}}}),yt=Ft(ct.prototype,"updateVisibleChildren",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.hasVisibleChildren.indexOf(t)>=0||r){e.hasVisibleChildren=e.hasVisibleChildren.filter((function(e){return e!=t}));var o=e.rootStore.levelStore.levels.filter((function(e){return e.parent==t}));o.forEach((function(t){return e.updateVisibleChildren(t.id,!0)}))}else e.hasVisibleChildren.push(t)}}}),St=Ft(ct.prototype,"expandAllLevels",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.hasVisibleChildren=e.rootStore.levelStore.levels.map((function(e){return e.id}))}}}),_t=Ft(ct.prototype,"collapseAllLevels",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){return e.hasVisibleChildren=[]}}}),Et=Ft(ct.prototype,"setAddLevelButtonLockedStatus",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return e.addLevelButtonIsLocked=t}}}),Ct=Ft(ct.prototype,"validateCustomTiers",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=!1,r=e.rootStore.levelStore.customTierSetKey,o=e.rootStore.levelStore.tierTemplates[r].tiers;e.setAddLevelButtonLockedStatus(!1);var n=o.map((function(e){var r=0===e.length||/^\s*$/.test(e)&&e.length>0,n=0,i=-1!==e.indexOf(",");return o.forEach((function(t){t==e&&(n+=1)})),r?(t=!0,{hasError:!0,msg:gettext("Please complete this field.")}):i?(t=!0,{hasError:!0,msg:gettext("Result levels should not contain commas.")}):n>1?(t=!0,{hasError:!0,msg:gettext("Result levels must have unique names.")}):{hasError:!1,msg:""}}));e.customFormErrors={hasErrors:t,errors:n}}}}),Tt=Ft(ct.prototype,"clearValidationMessages",[f.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.customFormErrors={hasErrors:!1,errors:[]}}}}),ct),Kt=jsContext,$t=new function e(t,r,o,n,i,a,l,s,c,u,p){Rt(this,e),this.levelStore=new Bt(t,r,o,n,i,a,l,s,c,u,p,this),this.uiStore=new zt(this)}(Kt.program,Kt.levels,Kt.indicators,Kt.levelTiers,Kt.tierTemplates,Kt.englishTemplates,Kt.customTemplates,Kt.programObjectives,Kt.accessLevel,Kt.usingResultsFramework,Kt.maxTiers);u.a.render(s.a.createElement(p.a,{rootStore:$t},s.a.createElement(s.a.Fragment,null,s.a.createElement(xt,null),s.a.createElement(_e,null))),document.querySelector("#level-builder-react-component")),Object(d.c)()},"WtQ/":function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return a}));function o(){$((function(){var e=0===window.performance.getEntriesByType("navigation")[0].transferSize,t="reload"===window.performance.getEntriesByType("navigation")[0].type;e&&!t&&window.location.reload()}))}var n=function(e){if(null==e||isNaN(parseFloat(e)))return null;var t,r=e.toString(),o=null;switch(e.toString().includes(",")?(r=e.toString().split(",")[0],o=e.toString().split(",").length>1?e.toString().split(",")[1]:null):e.toString().includes(".")&&(r=e.toString().split(".")[0],o=e.toString().split(".").length>1?e.toString().split(".")[1]:null),o=o&&o.length>0?o:null,window.userLang){case"es":t=r.replace(/\B(?=(\d{3})+(?!\d))/g,"."),o&&(t+=",".concat(o));break;case"fr":t=r.replace(/\B(?=(\d{3})+(?!\d))/g,String.fromCharCode(160)),o&&(t+=",".concat(o));break;case"en":default:t=r.replace(/\B(?=(\d{3})+(?!\d))/g,","),o&&(t+=".".concat(o))}return t},i=function(e){if(null==e||isNaN(parseFloat(e)))return null;var t=n(Math.round(1e4*e)/100);return null===t?null:"".concat(t,"%")},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.sort((function(e,r){return e[t].toUpperCase()>r[t].toUpperCase()?1:-1}))}},XoI5:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var o=r("vDqi"),n=r.n(o).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},hzyr:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return u}));var o=r("q1tI"),n=r.n(o),i=r("okNM");function a(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=Object(i.c)((function(e){var t=e.readonly,r=a(e,["readonly"]);return n.a.createElement("button",{type:"button",disabled:t,className:"btn btn-sm btn-link px-0 btn-add text-nowrap",onClick:function(e){openCreateIndicatorFormModal(r)}},n.a.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Add indicator"))})),s=Object(i.c)((function(e){var t=e.readonly,r=e.label,o=void 0===r?null:r,i=a(e,["readonly","label"]);return n.a.createElement("button",{type:"button",disabled:t,className:"btn btn-link",onClick:function(e){openUpdateIndicatorFormModal(i)}},n.a.createElement("i",{className:"fas fa-cog"}),o)})),c=Object(i.c)((function(e){var t=e.clickHandler,r=e.disabled;return n.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:t,disabled:r},n.a.createElement("i",{className:"fas fa-plus-square"}),gettext("Expand all"))})),u=Object(i.c)((function(e){var t=e.clickHandler,r=e.disabled;return n.a.createElement("button",{className:"btn btn-medium text-action btn-sm",onClick:t,disabled:r},n.a.createElement("i",{className:"fas fa-minus-square"}),gettext("Collapse all"))}))},qtBC:function(e,t,r){"use strict";var o=r("7+Rn"),n=r.n(o)()();t.a=n},v38i:function(e,t,r){"use strict";var o;r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"l",(function(){return l})),r.d(t,"i",(function(){return s})),r.d(t,"k",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"m",(function(){return p})),r.d(t,"j",(function(){return d})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return m})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return b}));var n={value:null,label:"---------"},i="—",a=i,l=1,s=2,c=[3,4,5,6,7],u=[1,2],p=Object.freeze({1:gettext("Life of Program (LoP) only"),2:gettext("Midline and endline"),3:gettext("Annual"),4:gettext("Semi-annual"),5:gettext("Tri-annual"),6:gettext("Quarterly"),7:gettext("Monthly")}),d=Object.freeze({3:gettext("Years"),4:gettext("Semi-annual periods"),5:gettext("Tri-annual periods"),6:gettext("Quarters"),7:gettext("Months")}),f=1,m=2;"undefined"!=typeof gettext&&gettext;var v,h=Object.freeze({noFilter:0,missingTarget:1,missingResults:2,missingEvidence:3,aboveTarget:5,belowTarget:6,onTarget:7,nonReporting:8}),b=null!==(v="reason_for_change_options",o="undefined"!=typeof JS_GLOBALS&&JS_GLOBALS.hasOwnProperty(v)?JS_GLOBALS[v]:null)&&void 0!==o?o:[]}},[["QTZG",0,1]]]);
//# sourceMappingURL=results_framework-80847a9160de41cee0cf.js.map